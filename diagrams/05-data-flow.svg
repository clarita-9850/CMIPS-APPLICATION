<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: bold 26px sans-serif; fill: #2c3e50; }
      .subtitle { font: 17px sans-serif; fill: #34495e; }
      .step-num { font: bold 20px sans-serif; fill: #ffffff; }
      .step-title { font: bold 15px sans-serif; fill: #2c3e50; }
      .text { font: 13px sans-serif; fill: #2c3e50; }
      .text-small { font: 11px sans-serif; fill: #34495e; }
      .code { font: 11px monospace; fill: #2c3e50; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e" />
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60" />
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">Request/Response Data Flow with Field Filtering</text>
  <text x="700" y="70" text-anchor="middle" class="subtitle">Example: Provider Creates Timesheet</text>
  
  <!-- Step 1: User Sends Request -->
  <circle cx="140" cy="130" r="25" fill="#3498db" />
  <text x="140" y="138" text-anchor="middle" class="step-num">1</text>
  
  <rect x="190" y="95" width="480" height="120" rx="8" fill="#e3f2fd" stroke="#3498db" stroke-width="2" />
  <text x="430" y="120" text-anchor="middle" class="step-title">User Sends Request (Provider)</text>
  
  <text x="210" y="145" class="text" font-weight="bold">POST /api/timesheets</text>
  <rect x="210" y="155" width="440" height="50" rx="5" fill="#ffffff" stroke="#bdc3c7" />
  <text x="220" y="172" class="code">{</text>
  <text x="230" y="186" class="code">  "employeeName": "John Doe", "department": "Healthcare",</text>
  <text x="230" y="200" class="code">  "regularHours": 80, "overtimeHours": 10, "paymentAmount": 5000</text>
  
  <!-- Arrow to Step 2 -->
  <path d="M 670 155 L 750 155" stroke="#34495e" stroke-width="3" marker-end="url(#arrow)" />
  
  <!-- Step 2: Authorization Check -->
  <circle cx="790" cy="130" r="25" fill="#9b59b6" />
  <text x="790" y="138" text-anchor="middle" class="step-num">2</text>
  
  <rect x="840" y="95" width="500" height="120" rx="8" fill="#f4ecf7" stroke="#9b59b6" stroke-width="2" />
  <text x="1090" y="120" text-anchor="middle" class="step-title">Authorization Check</text>
  
  <text x="860" y="145" class="text">✓ JWT Token Validated</text>
  <text x="860" y="165" class="text">✓ User Role: PROVIDER</text>
  <text x="860" y="185" class="text">✓ Permission Check: ✅ Granted</text>
  <text x="890" y="205" class="text-small">Resource: Timesheet | Scope: create | Policy: Provider Role</text>
  
  <!-- Arrow Down -->
  <path d="M 700 215 L 700 260" stroke="#34495e" stroke-width="3" marker-end="url(#arrow)" />
  
  <!-- Step 3: Field Filtering (Request) -->
  <circle cx="140" cy="310" r="25" fill="#e67e22" />
  <text x="140" y="318" text-anchor="middle" class="step-num">3</text>
  
  <rect x="190" y="260" width="1020" height="160" rx="8" fill="#fef5e7" stroke="#e67e22" stroke-width="3" />
  <text x="700" y="285" text-anchor="middle" class="step-title">Field-Level Filtering (Request)</text>
  
  <rect x="210" y="300" width="450" height="105" rx="5" fill="#ffffff" stroke="#e74c3c" stroke-width="2" />
  <text x="435" y="320" text-anchor="middle" class="text" font-weight="bold">Incoming Request (All Fields)</text>
  <text x="220" y="340" class="code">employeeName: "John Doe"</text>
  <text x="220" y="355" class="code">department: "Healthcare"</text>
  <text x="220" y="370" class="code">regularHours: 80</text>
  <text x="220" y="385" class="code">overtimeHours: 10</text>
  <text x="220" y="400" class="code" fill="#e74c3c">paymentAmount: 5000  ❌ FILTERED OUT</text>
  
  <text x="675" y="345" class="text" font-size="24" fill="#e67e22">→</text>
  
  <rect x="720" y="300" width="470" height="105" rx="5" fill="#d5f4e6" stroke="#27ae60" stroke-width="2" />
  <text x="955" y="320" text-anchor="middle" class="text" font-weight="bold">After Filtering (Allowed Fields Only)</text>
  <text x="730" y="340" class="code">employeeName: "John Doe"  ✓</text>
  <text x="730" y="355" class="code">department: "Healthcare"  ✓</text>
  <text x="730" y="370" class="code">regularHours: 80  ✓</text>
  <text x="730" y="385" class="code">overtimeHours: 10  ✓</text>
  
  <rect x="210" y="415" width="980" height="30" rx="5" fill="#e8f8f5" />
  <text x="700" y="435" text-anchor="middle" class="text-small" font-weight="bold">Configuration: provider_create_fields = "employeeName,department,regularHours,overtimeHours"</text>
  
  <!-- Arrow Down -->
  <path d="M 700 420 L 700 465" stroke="#34495e" stroke-width="3" marker-end="url(#arrow)" />
  
  <!-- Step 4: Business Logic -->
  <circle cx="140" cy="510" r="25" fill="#27ae60" />
  <text x="140" y="518" text-anchor="middle" class="step-num">4</text>
  
  <rect x="190" y="465" width="480" height="130" rx="8" fill="#d5f4e6" stroke="#27ae60" stroke-width="2" />
  <text x="430" y="490" text-anchor="middle" class="step-title">Business Logic Processing</text>
  
  <text x="210" y="515" class="text">✓ Validate data (not null, correct format)</text>
  <text x="210" y="535" class="text">✓ Calculate total hours: 80 + 10 = 90</text>
  <text x="210" y="555" class="text">✓ Set status: DRAFT</text>
  <text x="210" y="575" class="text">✓ Save to database</text>
  
  <!-- Step 5: Database -->
  <circle cx="790" cy="510" r="25" fill="#34495e" />
  <text x="790" y="518" text-anchor="middle" class="step-num">5</text>
  
  <rect x="840" y="465" width="500" height="130" rx="8" fill="#ecf0f1" stroke="#34495e" stroke-width="2" />
  <text x="1090" y="490" text-anchor="middle" class="step-title">Database Record Created</text>
  
  <rect x="860" y="505" width="460" height="80" rx="5" fill="#ffffff" stroke="#95a5a6" />
  <text x="870" y="520" class="code">id: 123 (auto-generated)</text>
  <text x="870" y="535" class="code">employeeName: "John Doe"</text>
  <text x="870" y="550" class="code">regularHours: 80, overtimeHours: 10</text>
  <text x="870" y="565" class="code">status: DRAFT, totalHours: 90</text>
  <text x="870" y="580" class="code">createdAt: 2025-10-09T10:30:00Z</text>
  
  <!-- Arrow Down -->
  <path d="M 700 595 L 700 640" stroke="#34495e" stroke-width="3" marker-end="url(#arrow)" />
  
  <!-- Step 6: Field Filtering (Response) -->
  <circle cx="140" cy="690" r="25" fill="#3498db" />
  <text x="140" y="698" text-anchor="middle" class="step-num">6</text>
  
  <rect x="190" y="640" width="1020" height="160" rx="8" fill="#e3f2fd" stroke="#3498db" stroke-width="3" />
  <text x="700" y="665" text-anchor="middle" class="step-title">Field-Level Filtering (Response)</text>
  
  <rect x="210" y="680" width="450" height="105" rx="5" fill="#ffffff" stroke="#e67e22" stroke-width="2" />
  <text x="435" y="700" text-anchor="middle" class="text" font-weight="bold">Database Record (All Fields)</text>
  <text x="220" y="720" class="code">id: 123</text>
  <text x="220" y="735" class="code">employeeName: "John Doe"</text>
  <text x="220" y="750" class="code">regularHours: 80, overtimeHours: 10</text>
  <text x="220" y="765" class="code">status: DRAFT</text>
  <text x="220" y="780" class="code" fill="#e74c3c">createdAt: 2025-10-09... ❌ FILTERED</text>
  
  <text x="675" y="725" class="text" font-size="24" fill="#3498db">→</text>
  
  <rect x="720" y="680" width="470" height="105" rx="5" fill="#d5f4e6" stroke="#27ae60" stroke-width="2" />
  <text x="955" y="700" text-anchor="middle" class="text" font-weight="bold">Response to User (Read Fields Only)</text>
  <text x="730" y="720" class="code">id: 123  ✓</text>
  <text x="730" y="735" class="code">employeeName: "John Doe"  ✓</text>
  <text x="730" y="750" class="code">regularHours: 80  ✓</text>
  <text x="730" y="765" class="code">overtimeHours: 10  ✓</text>
  <text x="730" y="780" class="code">status: DRAFT  ✓</text>
  
  <rect x="210" y="795" width="980" height="30" rx="5" fill="#e8f8f5" />
  <text x="700" y="815" text-anchor="middle" class="text-small" font-weight="bold">Configuration: provider_read_fields = "id,employeeName,regularHours,overtimeHours,status"</text>
  
  <!-- Arrow Down -->
  <path d="M 700 825 L 700 870" stroke="#27ae60" stroke-width="4" marker-end="url(#arrow-green)" />
  
  <!-- Step 7: User Receives Response -->
  <circle cx="140" cy="920" r="25" fill="#27ae60" />
  <text x="140" y="928" text-anchor="middle" class="step-num">7</text>
  
  <rect x="190" y="870" width="1020" height="80" rx="8" fill="#d5f4e6" stroke="#27ae60" stroke-width="3" />
  <text x="700" y="895" text-anchor="middle" class="step-title">✓ User Receives Filtered Response</text>
  
  <text x="210" y="920" class="text" font-weight="bold">Frontend displays only returned fields:</text>
  <text x="220" y="940" class="text">ID: 123 | Name: John Doe | Hours: 80 regular, 10 overtime | Status: DRAFT</text>
  
  <!-- Legend -->
  <rect x="50" y="970" width="20" height="15" fill="#e74c3c" />
  <text x="80" y="982" class="text-small">Filtered Out (Not Allowed)</text>
  
  <rect x="300" y="970" width="20" height="15" fill="#27ae60" />
  <text x="330" y="982" class="text-small">Allowed (Passed Filter)</text>
  
  <rect x="550" y="970" width="20" height="15" fill="#3498db" />
  <text x="580" y="982" class="text-small">API Request/Response</text>
  
  <rect x="800" y="970" width="20" height="15" fill="#9b59b6" />
  <text x="830" y="982" class="text-small">Security Check</text>
  
  <rect x="1050" y="970" width="20" height="15" fill="#e67e22" />
  <text x="1080" y="982" class="text-small">Field Filtering</text>
</svg>


