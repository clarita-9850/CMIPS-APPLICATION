<svg width="2000" height="2800" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="1000" y="30" font-family="Arial, sans-serif" font-size="26" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    AWS Security Groups - Complete Detailed Explanation
  </text>
  <text x="1000" y="55" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#666">
    Network Security Architecture &amp; Traffic Flow Control
  </text>
  
  <!-- Main Container -->
  <rect x="50" y="80" width="1900" height="2680" fill="#f0f8ff" stroke="#1e3a8a" stroke-width="2" rx="10"/>
  
  <!-- Internet Layer -->
  <rect x="100" y="110" width="1800" height="100" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="1000" y="140" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1976d2">
    Internet (Public)
  </text>
  <text x="1000" y="160" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
    Users access application via HTTPS (Port 443) | DDoS Protection: AWS Shield | WAF: Web Application Firewall
  </text>
  <text x="1000" y="180" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
    Source IP: Any (0.0.0.0/0) | Destination: ALB Public IP
  </text>
  <text x="1000" y="195" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
    üîí All traffic encrypted with TLS 1.2+ | Certificate: ACM (AWS Certificate Manager)
  </text>
  
  <!-- ALB Security Group -->
  <rect x="100" y="230" width="1800" height="180" fill="#e8f5e9" stroke="#2e7d32" stroke-width="3" rx="5"/>
  <text x="1000" y="260" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#2e7d32">
    Application Load Balancer (ALB) - Security Group: sg-alb-xxxxx
  </text>
  
  <rect x="120" y="280" width="880" height="120" fill="#ffffff" stroke="#2e7d32" stroke-width="1" rx="3"/>
  <text x="560" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">
    INBOUND RULES (Who can reach ALB)
  </text>
  <text x="140" y="330" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Rule 1:</text>
  <text x="200" y="330" font-family="Arial, sans-serif" font-size="10" fill="#333">Type: HTTPS | Protocol: TCP | Port: 443</text>
  <text x="140" y="350" font-family="Arial, sans-serif" font-size="10" fill="#666">Source: 0.0.0.0/0 (Internet) | Description: Allow HTTPS from Internet</text>
  <text x="140" y="370" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ SSL/TLS Termination | ‚úÖ Health Checks | ‚úÖ Sticky Sessions</text>
  <text x="140" y="390" font-family="Arial, sans-serif" font-size="10" fill="#666">üîí Certificate: ACM | üîí TLS 1.2+ Only | üîí Perfect Forward Secrecy</text>
  
  <rect x="1020" y="280" width="860" height="120" fill="#ffffff" stroke="#2e7d32" stroke-width="1" rx="3"/>
  <text x="1450" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">
    OUTBOUND RULES (Where ALB can connect)
  </text>
  <text x="1040" y="330" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Rule 1:</text>
  <text x="1100" y="330" font-family="Arial, sans-serif" font-size="10" fill="#333">Type: HTTP | Protocol: TCP | Port: 80</text>
  <text x="1040" y="350" font-family="Arial, sans-serif" font-size="10" fill="#666">Destination: sg-frontend-xxxxx (Frontend Security Group)</text>
  <text x="1040" y="370" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Routes to healthy Frontend containers only | ‚úÖ Health check: GET /health</text>
  <text x="1040" y="390" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Load balancing: Round-robin / Least connections | ‚úÖ Auto-scaling aware</text>
  
  <!-- VPC -->
  <rect x="150" y="440" width="1700" height="2200" fill="#e6f2ff" stroke="#1e40af" stroke-width="2" stroke-dasharray="5,5" rx="8"/>
  <text x="1000" y="470" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e40af">
    VPC (Virtual Private Cloud) - 10.0.0.0/16
  </text>
  
  <!-- Public Subnet -->
  <rect x="200" y="500" width="800" height="600" fill="#ffffff" stroke="#28a745" stroke-width="2" rx="5"/>
  <text x="600" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#28a745">
    Public Subnet (10.0.1.0/24)
  </text>
  <text x="600" y="550" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
    Internet Gateway | Route Table: 0.0.0.0/0 ‚Üí IGW | NAT Gateway (for outbound)
  </text>
  
  <!-- Frontend Security Group -->
  <rect x="230" y="580" width="740" height="240" fill="#4a90e2" stroke="#1e3a8a" stroke-width="3" rx="5"/>
  <text x="600" y="610" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Frontend Container (Next.js) - Security Group: sg-frontend-xxxxx
  </text>
  <text x="600" y="630" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    ECS Task | Port: 3000 (Internal) | Public IP: No | Private IP: 10.0.1.10
  </text>
  
  <rect x="250" y="650" width="700" height="160" fill="#ffffff" stroke="#1e3a8a" stroke-width="1" rx="3"/>
  <text x="600" y="675" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    INBOUND RULES
  </text>
  <text x="270" y="700" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e3a8a">Rule 1: Allow HTTP from ALB</text>
  <text x="270" y="720" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: HTTP | Protocol: TCP | Port: 80</text>
  <text x="270" y="735" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Source: sg-alb-xxxxx (ALB Security Group ID)</text>
  <text x="270" y="750" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Only ALB can reach Frontend | ‚úÖ No direct internet access | ‚úÖ Isolated from public</text>
  <text x="270" y="770" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ ALB handles SSL termination (HTTPS ‚Üí HTTP) | ‚úÖ Health checks allowed</text>
  <text x="270" y="790" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Direct access from Internet (0.0.0.0/0:80) | ‚ùå DENIED: Access from other SGs</text>
  
  <text x="600" y="820" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    OUTBOUND RULES
  </text>
  <text x="270" y="845" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e3a8a">Rule 1: Allow HTTPS to Backend</text>
  <text x="270" y="865" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: HTTPS | Protocol: TCP | Port: 443</text>
  <text x="270" y="880" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Destination: sg-backend-xxxxx (Backend Security Group ID)</text>
  <text x="270" y="895" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Encrypted communication to Backend | ‚úÖ Only connects to Backend</text>
  <text x="270" y="910" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Direct database access | ‚ùå DENIED: Direct Kafka access</text>
  
  <!-- Keycloak in Public Subnet -->
  <rect x="230" y="800" width="740" height="120" fill="#ff6b6b" stroke="#c92a2a" stroke-width="2" rx="5"/>
  <text x="600" y="830" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Keycloak Server - Security Group: sg-keycloak-xxxxx
  </text>
  <text x="600" y="850" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    Port: 8080 | Private IP: 10.0.1.20
  </text>
  <text x="270" y="875" font-family="Arial, sans-serif" font-size="10" fill="#333">Inbound: HTTPS (443) from Frontend SG | Outbound: HTTPS (443) to Internet (for token validation)</text>
  <text x="270" y="895" font-family="Arial, sans-serif" font-size="10" fill="#333">‚úÖ JWT token issuance | ‚úÖ User authentication | ‚úÖ Role management</text>
  
  <!-- Private Subnet -->
  <rect x="1050" y="500" width="800" height="900" fill="#fff5f5" stroke="#dc3545" stroke-width="2" rx="5"/>
  <text x="1450" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#dc3545">
    Private Subnet (10.0.2.0/24)
  </text>
  <text x="1450" y="550" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
    NAT Gateway | Route Table: 0.0.0.0/0 ‚Üí NAT Gateway | No Internet Gateway
  </text>
  
  <!-- Backend Security Group -->
  <rect x="1080" y="580" width="740" height="300" fill="#51cf66" stroke="#2b8a3e" stroke-width="3" rx="5"/>
  <text x="1450" y="610" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Backend Container (Spring Boot) - Security Group: sg-backend-xxxxx
  </text>
  <text x="1450" y="630" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    ECS Task | Port: 8081 (Internal) | Public IP: No | Private IP: 10.0.2.10
  </text>
  
  <rect x="1100" y="650" width="700" height="220" fill="#ffffff" stroke="#2b8a3e" stroke-width="1" rx="3"/>
  <text x="1450" y="675" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2b8a3e">
    INBOUND RULES
  </text>
  <text x="1120" y="700" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2b8a3e">Rule 1: Allow HTTPS from Frontend</text>
  <text x="1120" y="720" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: HTTPS | Protocol: TCP | Port: 443</text>
  <text x="1120" y="735" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Source: sg-frontend-xxxxx (Frontend Security Group ID)</text>
  <text x="1120" y="750" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Only Frontend can reach Backend | ‚úÖ Encrypted API communication</text>
  <text x="1120" y="765" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ JWT token validation | ‚úÖ Role-based authorization</text>
  <text x="1120" y="780" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Direct access from Internet | ‚ùå DENIED: Access from other SGs</text>
  <text x="1120" y="795" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Direct database access from Frontend | ‚ùå DENIED: Direct Kafka access from Frontend</text>
  <text x="1120" y="810" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Unauthorized API calls | ‚ùå DENIED: Port scanning attempts</text>
  
  <text x="1450" y="840" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2b8a3e">
    OUTBOUND RULES
  </text>
  <text x="1120" y="865" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2b8a3e">Rule 1: Allow PostgreSQL to RDS</text>
  <text x="1120" y="880" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: PostgreSQL | Protocol: TCP | Port: 5432</text>
  <text x="1120" y="895" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Destination: sg-rds-xxxxx (RDS Security Group ID)</text>
  <text x="1120" y="910" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Database queries | ‚úÖ Connection pooling (HikariCP) | ‚úÖ SSL/TLS encryption</text>
  
  <text x="1120" y="935" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2b8a3e">Rule 2: Allow Kafka to MSK</text>
  <text x="1120" y="950" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: Custom TCP | Protocol: TCP | Port: 9092</text>
  <text x="1120" y="965" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Destination: sg-msk-xxxxx (MSK Security Group ID)</text>
  <text x="1120" y="980" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Event publishing | ‚úÖ Event consumption | ‚úÖ TLS encryption</text>
  
  <text x="1120" y="1005" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2b8a3e">Rule 3: Allow HTTPS to Internet</text>
  <text x="1120" y="1020" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: HTTPS | Protocol: TCP | Port: 443</text>
  <text x="1120" y="1035" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Destination: 0.0.0.0/0 (Internet) via NAT Gateway</text>
  <text x="1120" y="1050" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Keycloak token validation | ‚úÖ External API calls | ‚úÖ Software updates</text>
  
  <!-- RDS Security Group -->
  <rect x="1080" y="900" width="740" height="200" fill="#339af0" stroke="#1c7ed6" stroke-width="3" rx="5"/>
  <text x="1450" y="930" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    PostgreSQL RDS - Security Group: sg-rds-xxxxx
  </text>
  <text x="1450" y="950" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    RDS Instance | Port: 5432 | Multi-AZ | Private IP: 10.0.2.20 | No Public IP
  </text>
  
  <rect x="1100" y="970" width="700" height="120" fill="#ffffff" stroke="#1c7ed6" stroke-width="1" rx="3"/>
  <text x="1450" y="995" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1c7ed6">
    INBOUND RULES
  </text>
  <text x="1120" y="1020" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1c7ed6">Rule 1: Allow PostgreSQL from Backend</text>
  <text x="1120" y="1040" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: PostgreSQL | Protocol: TCP | Port: 5432</text>
  <text x="1120" y="1055" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Source: sg-backend-xxxxx (Backend Security Group ID)</text>
  <text x="1120" y="1070" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Only Backend can access database | ‚úÖ No direct internet access</text>
  <text x="1120" y="1085" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Encrypted at rest (AES-256) | ‚úÖ SSL/TLS in transit | ‚úÖ IAM database authentication</text>
  <text x="1120" y="1100" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Direct access from Frontend | ‚ùå DENIED: Access from Internet</text>
  <text x="1120" y="1115" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: SQL injection attempts from unauthorized sources | ‚ùå DENIED: Port 5432 from anywhere else</text>
  
  <text x="1450" y="1135" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1c7ed6">
    OUTBOUND RULES
  </text>
  <text x="1120" y="1155" font-family="Arial, sans-serif" font-size="10" fill="#666">Default: All outbound allowed (for Multi-AZ replication, automated backups, CloudWatch logs)</text>
  
  <!-- MSK Security Group -->
  <rect x="1080" y="1120" width="740" height="200" fill="#ffd43b" stroke="#f59f00" stroke-width="3" rx="5"/>
  <text x="1450" y="1150" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">
    Kafka MSK Cluster - Security Group: sg-msk-xxxxx
  </text>
  <text x="1450" y="1170" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#333">
    MSK Cluster | Port: 9092 | Multi-AZ | Private IPs: 10.0.2.30-32 | No Public IPs
  </text>
  
  <rect x="1100" y="1190" width="700" height="120" fill="#ffffff" stroke="#f59f00" stroke-width="1" rx="3"/>
  <text x="1450" y="1215" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#f59f00">
    INBOUND RULES
  </text>
  <text x="1120" y="1240" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#f59f00">Rule 1: Allow Kafka from Backend</text>
  <text x="1120" y="1260" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Type: Custom TCP | Protocol: TCP | Port: 9092</text>
  <text x="1120" y="1275" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Source: sg-backend-xxxxx (Backend Security Group ID)</text>
  <text x="1120" y="1290" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ Only Backend can publish/consume events | ‚úÖ TLS encryption</text>
  <text x="1120" y="1305" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ SASL/SCRAM authentication | ‚úÖ ACLs for topic-level permissions</text>
  <text x="1120" y="1320" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Direct access from Frontend | ‚ùå DENIED: Access from Internet</text>
  <text x="1120" y="1335" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: Unauthorized event publishing | ‚ùå DENIED: Port 9092 from anywhere else</text>
  
  <text x="1450" y="1355" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#f59f00">
    OUTBOUND RULES
  </text>
  <text x="1120" y="1375" font-family="Arial, sans-serif" font-size="10" fill="#666">Default: All outbound allowed (for broker-to-broker communication, Zookeeper coordination, replication)</text>
  
  <!-- Network Flow Diagram -->
  <text x="1000" y="1380" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    Complete Network Flow with Security Groups
  </text>
  
  <rect x="100" y="1410" width="1800" height="400" fill="#ffffff" stroke="#1e3a8a" stroke-width="2" rx="5"/>
  <text x="1000" y="1440" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    Address Change Request Flow - Step by Step
  </text>
  
  <rect x="120" y="1460" width="1760" height="340" fill="#f8f9fa" stroke="#1e3a8a" stroke-width="1" rx="3"/>
  
  <!-- Flow Step 1 -->
  <rect x="140" y="1480" width="1700" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="150" y="1500" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1976d2">Step 1: User Browser ‚Üí ALB</text>
  <text x="150" y="1515" font-family="Arial, sans-serif" font-size="10" fill="#333">Source: Internet (0.0.0.0/0) | Destination: ALB Public IP | Protocol: HTTPS (443)</text>
  <text x="150" y="1530" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ ALLOWED by ALB SG: Inbound Rule (0.0.0.0/0:443) | ‚úÖ SSL/TLS Encrypted | ‚úÖ WAF Protection</text>
  
  <!-- Flow Step 2 -->
  <rect x="140" y="1540" width="1700" height="50" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1" rx="3"/>
  <text x="150" y="1560" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Step 2: ALB ‚Üí Frontend Container</text>
  <text x="150" y="1575" font-family="Arial, sans-serif" font-size="10" fill="#333">Source: sg-alb-xxxxx | Destination: Frontend Container (10.0.1.10) | Protocol: HTTP (80)</text>
  <text x="150" y="1590" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ ALLOWED by Frontend SG: Inbound Rule (sg-alb:80) | ‚úÖ SSL Termination at ALB | ‚úÖ Health check passed</text>
  
  <!-- Flow Step 3 -->
  <rect x="140" y="1600" width="1700" height="50" fill="#fff3e0" stroke="#e65100" stroke-width="1" rx="3"/>
  <text x="150" y="1620" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">Step 3: Frontend ‚Üí Backend API</text>
  <text x="150" y="1635" font-family="Arial, sans-serif" font-size="10" fill="#333">Source: sg-frontend-xxxxx | Destination: Backend Container (10.0.2.10) | Protocol: HTTPS (443)</text>
  <text x="150" y="1650" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ ALLOWED by Backend SG: Inbound Rule (sg-frontend:443) | ‚úÖ Encrypted API call | ‚úÖ JWT token in header</text>
  
  <!-- Flow Step 4 -->
  <rect x="140" y="1660" width="1700" height="50" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1" rx="3"/>
  <text x="150" y="1680" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7b1fa2">Step 4: Backend ‚Üí PostgreSQL Database</text>
  <text x="150" y="1695" font-family="Arial, sans-serif" font-size="10" fill="#333">Source: sg-backend-xxxxx | Destination: RDS Instance (10.0.2.20) | Protocol: PostgreSQL (5432)</text>
  <text x="150" y="1710" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ ALLOWED by RDS SG: Inbound Rule (sg-backend:5432) | ‚úÖ SSL/TLS Encrypted | ‚úÖ Connection pooling</text>
  <text x="150" y="1725" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: If Frontend tried to connect directly (not in RDS SG rules)</text>
  
  <!-- Flow Step 5 -->
  <rect x="140" y="1740" width="1700" height="50" fill="#ffd43b" stroke="#f59f00" stroke-width="1" rx="3"/>
  <text x="150" y="1760" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#f59f00">Step 5: Backend ‚Üí Kafka MSK Cluster</text>
  <text x="150" y="1775" font-family="Arial, sans-serif" font-size="10" fill="#333">Source: sg-backend-xxxxx | Destination: MSK Broker (10.0.2.30) | Protocol: Kafka (9092)</text>
  <text x="150" y="1790" font-family="Arial, sans-serif" font-size="10" fill="#666">‚úÖ ALLOWED by MSK SG: Inbound Rule (sg-backend:9092) | ‚úÖ TLS Encrypted | ‚úÖ SASL Authentication</text>
  <text x="150" y="1805" font-family="Arial, sans-serif" font-size="10" fill="#ff0000">‚ùå DENIED: If Frontend tried to connect directly (not in MSK SG rules)</text>
  
  <!-- Security Principles -->
  <text x="1000" y="1860" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    Security Principles Applied
  </text>
  
  <rect x="100" y="1890" width="1800" height="300" fill="#ffffff" stroke="#1e3a8a" stroke-width="2" rx="5"/>
  
  <rect x="120" y="1920" width="860" height="260" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1" rx="3"/>
  <text x="550" y="1945" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">
    ‚úÖ Secure Configuration (What We Have)
  </text>
  <text x="140" y="1970" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">1. Least Privilege:</text>
  <text x="140" y="1985" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Each SG allows only necessary traffic</text>
  <text x="140" y="2000" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ No "allow all" (0.0.0.0/0) rules for sensitive resources</text>
  <text x="140" y="2015" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Source/destination restricted to specific SGs</text>
  
  <text x="140" y="2040" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">2. Defense in Depth:</text>
  <text x="140" y="2055" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Multiple security layers (ALB ‚Üí Frontend ‚Üí Backend ‚Üí Database)</text>
  <text x="140" y="2070" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Each layer has its own security group</text>
  <text x="140" y="2085" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Breach at one layer doesn't compromise others</text>
  
  <text x="140" y="2110" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">3. Network Isolation:</text>
  <text x="140" y="2125" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Database in private subnet, no public IP</text>
  <text x="140" y="2140" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Kafka in private subnet, no public IP</text>
  <text x="140" y="2155" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Only application layer can access data layer</text>
  
  <text x="140" y="2180" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">4. Security Group References:</text>
  <text x="140" y="2195" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Uses SG IDs instead of IP addresses</text>
  <text x="140" y="2210" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Dynamic: Works with auto-scaling</text>
  <text x="140" y="2225" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Maintainable: No IP updates needed</text>
  
  <rect x="1020" y="1920" width="860" height="260" fill="#ffebee" stroke="#c62828" stroke-width="1" rx="3"/>
  <text x="1450" y="1945" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#c62828">
    ‚ùå Insecure Configuration (What NOT to Do)
  </text>
  <text x="1040" y="1970" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#c62828">1. Overly Permissive Rules:</text>
  <text x="1040" y="1985" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Frontend SG: 0.0.0.0/0:80 (Anyone can access)</text>
  <text x="1040" y="2000" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Backend SG: 0.0.0.0/0:8081 (Exposed to internet)</text>
  <text x="1040" y="2015" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ RDS SG: 0.0.0.0/0:5432 (Database exposed!)</text>
  
  <text x="1040" y="2040" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#c62828">2. No Network Isolation:</text>
  <text x="1040" y="2055" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Database with public IP</text>
  <text x="1040" y="2070" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Direct internet access to sensitive resources</text>
  <text x="1040" y="2085" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Vulnerable to brute force attacks</text>
  
  <text x="1040" y="2110" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#c62828">3. Missing Encryption:</text>
  <text x="1040" y="2125" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ HTTP instead of HTTPS</text>
  <text x="1040" y="2140" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Unencrypted database connections</text>
  <text x="1040" y="2155" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Plain text data transmission</text>
  
  <text x="1040" y="2180" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#c62828">4. Hard-coded IPs:</text>
  <text x="1040" y="2195" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Using IP addresses instead of SG references</text>
  <text x="1040" y="2210" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Breaks with auto-scaling</text>
  <text x="1040" y="2225" font-family="Arial, sans-serif" font-size="10" fill="#333">‚Ä¢ Requires manual updates</text>
  
  <!-- Security Group Rules Summary Table -->
  <text x="1000" y="2250" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    Security Group Rules Summary Table
  </text>
  
  <rect x="100" y="2280" width="1800" height="450" fill="#ffffff" stroke="#1e3a8a" stroke-width="2" rx="5"/>
  
  <!-- Table Header -->
  <rect x="120" y="2300" width="1760" height="30" fill="#1e3a8a" stroke="#1e3a8a" stroke-width="1" rx="3"/>
  <text x="200" y="2320" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Security Group</text>
  <text x="500" y="2320" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Inbound Rules</text>
  <text x="1000" y="2320" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Outbound Rules</text>
  <text x="1500" y="2320" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Purpose</text>
  
  <!-- ALB Row -->
  <rect x="120" y="2340" width="1760" height="50" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1" rx="2"/>
  <text x="200" y="2360" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2e7d32">sg-alb-xxxxx</text>
  <text x="200" y="2375" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">ALB</text>
  <text x="500" y="2365" font-family="Arial, sans-serif" font-size="10" fill="#333">HTTPS (443) from 0.0.0.0/0</text>
  <text x="500" y="2380" font-family="Arial, sans-serif" font-size="9" fill="#666">Internet access</text>
  <text x="1000" y="2365" font-family="Arial, sans-serif" font-size="10" fill="#333">HTTP (80) to sg-frontend</text>
  <text x="1000" y="2380" font-family="Arial, sans-serif" font-size="9" fill="#666">Routes to Frontend</text>
  <text x="1500" y="2365" font-family="Arial, sans-serif" font-size="10" fill="#333">SSL termination, load balancing</text>
  <text x="1500" y="2380" font-family="Arial, sans-serif" font-size="9" fill="#666">Health checks, routing</text>
  
  <!-- Frontend Row -->
  <rect x="120" y="2400" width="1760" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" rx="2"/>
  <text x="200" y="2420" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#1976d2">sg-frontend-xxxxx</text>
  <text x="200" y="2435" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">Frontend</text>
  <text x="500" y="2425" font-family="Arial, sans-serif" font-size="10" fill="#333">HTTP (80) from sg-alb</text>
  <text x="500" y="2440" font-family="Arial, sans-serif" font-size="9" fill="#666">Only from ALB</text>
  <text x="1000" y="2425" font-family="Arial, sans-serif" font-size="10" fill="#333">HTTPS (443) to sg-backend</text>
  <text x="1000" y="2440" font-family="Arial, sans-serif" font-size="9" fill="#666">API calls only</text>
  <text x="1500" y="2425" font-family="Arial, sans-serif" font-size="10" fill="#333">User interface, no direct DB access</text>
  <text x="1500" y="2440" font-family="Arial, sans-serif" font-size="9" fill="#666">Isolated from data layer</text>
  
  <!-- Backend Row -->
  <rect x="120" y="2460" width="1760" height="50" fill="#e0f2e0" stroke="#2b8a3e" stroke-width="1" rx="2"/>
  <text x="200" y="2480" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2b8a3e">sg-backend-xxxxx</text>
  <text x="200" y="2495" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">Backend</text>
  <text x="500" y="2485" font-family="Arial, sans-serif" font-size="10" fill="#333">HTTPS (443) from sg-frontend</text>
  <text x="500" y="2500" font-family="Arial, sans-serif" font-size="9" fill="#666">Only from Frontend</text>
  <text x="1000" y="2485" font-family="Arial, sans-serif" font-size="10" fill="#333">PostgreSQL (5432) to sg-rds</text>
  <text x="1000" y="2500" font-family="Arial, sans-serif" font-size="9" fill="#666">Kafka (9092) to sg-msk | HTTPS (443) to Internet</text>
  <text x="1500" y="2485" font-family="Arial, sans-serif" font-size="10" fill="#333">Business logic, API processing</text>
  <text x="1500" y="2500" font-family="Arial, sans-serif" font-size="9" fill="#666">Only layer with DB/Kafka access</text>
  
  <!-- RDS Row -->
  <rect x="120" y="2520" width="1760" height="50" fill="#e0f0ff" stroke="#1c7ed6" stroke-width="1" rx="2"/>
  <text x="200" y="2540" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#1c7ed6">sg-rds-xxxxx</text>
  <text x="200" y="2555" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">PostgreSQL</text>
  <text x="500" y="2545" font-family="Arial, sans-serif" font-size="10" fill="#333">PostgreSQL (5432) from sg-backend</text>
  <text x="500" y="2560" font-family="Arial, sans-serif" font-size="9" fill="#666">Only from Backend</text>
  <text x="1000" y="2545" font-family="Arial, sans-serif" font-size="10" fill="#333">All outbound (replication, backups)</text>
  <text x="1000" y="2560" font-family="Arial, sans-serif" font-size="9" fill="#666">Multi-AZ, CloudWatch</text>
  <text x="1500" y="2545" font-family="Arial, sans-serif" font-size="10" fill="#333">Data storage, no internet access</text>
  <text x="1500" y="2560" font-family="Arial, sans-serif" font-size="9" fill="#666">Isolated in private subnet</text>
  
  <!-- MSK Row -->
  <rect x="120" y="2580" width="1760" height="50" fill="#fff9e0" stroke="#f59f00" stroke-width="1" rx="2"/>
  <text x="200" y="2600" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#f59f00">sg-msk-xxxxx</text>
  <text x="200" y="2615" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">Kafka MSK</text>
  <text x="500" y="2605" font-family="Arial, sans-serif" font-size="10" fill="#333">Kafka (9092) from sg-backend</text>
  <text x="500" y="2620" font-family="Arial, sans-serif" font-size="9" fill="#666">Only from Backend</text>
  <text x="1000" y="2605" font-family="Arial, sans-serif" font-size="10" fill="#333">All outbound (broker coordination)</text>
  <text x="1000" y="2620" font-family="Arial, sans-serif" font-size="9" fill="#666">Zookeeper, replication</text>
  <text x="1500" y="2605" font-family="Arial, sans-serif" font-size="10" fill="#333">Event streaming, no internet access</text>
  <text x="1500" y="2620" font-family="Arial, sans-serif" font-size="9" fill="#666">Isolated in private subnet</text>
  
  <!-- Key Features -->
  <text x="1000" y="2680" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    Key Security Features
  </text>
  
  <rect x="100" y="2700" width="1800" height="50" fill="#fff3e0" stroke="#e65100" stroke-width="1" rx="3"/>
  <text x="200" y="2720" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">‚úÖ Stateful Firewall:</text>
  <text x="350" y="2720" font-family="Arial, sans-serif" font-size="10" fill="#333">If inbound allowed, response automatically allowed outbound</text>
  <text x="800" y="2720" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">‚úÖ Default Deny:</text>
  <text x="950" y="2720" font-family="Arial, sans-serif" font-size="10" fill="#333">All traffic denied by default, only explicit allows</text>
  <text x="1300" y="2720" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">‚úÖ SG References:</text>
  <text x="1450" y="2720" font-family="Arial, sans-serif" font-size="10" fill="#333">Dynamic, works with auto-scaling</text>
  
  <rect x="100" y="2750" width="1800" height="50" fill="#fff3e0" stroke="#e65100" stroke-width="1" rx="3"/>
  <text x="200" y="2770" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">‚úÖ Least Privilege:</text>
  <text x="350" y="2770" font-family="Arial, sans-serif" font-size="10" fill="#333">Only necessary ports and protocols allowed</text>
  <text x="800" y="2770" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">‚úÖ Network Isolation:</text>
  <text x="950" y="2770" font-family="Arial, sans-serif" font-size="10" fill="#333">Sensitive resources in private subnet, no public IPs</text>
  <text x="1300" y="2770" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">‚úÖ Encryption:</text>
  <text x="1450" y="2770" font-family="Arial, sans-serif" font-size="10" fill="#333">TLS/SSL for all external communications</text>
  
  <!-- Arrows showing flow -->
  <path d="M 1000 210 L 1000 280" stroke="#2e7d32" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 600 410 L 600 580" stroke="#28a745" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 600 820 L 1450 650" stroke="#2b8a3e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 1450 880 L 1450 970" stroke="#1c7ed6" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 1450 1100 L 1450 1190" stroke="#f59f00" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="11" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#333"/>
    </marker>
  </defs>
</svg>





