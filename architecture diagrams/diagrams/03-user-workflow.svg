<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: bold 26px sans-serif; fill: #2c3e50; }
      .subtitle { font: 18px sans-serif; fill: #34495e; }
      .role-title { font: bold 16px sans-serif; fill: #ffffff; }
      .step-title { font: bold 14px sans-serif; fill: #2c3e50; }
      .text { font: 13px sans-serif; fill: #2c3e50; }
      .text-white { font: 13px sans-serif; fill: #ffffff; }
      .small-text { font: 11px sans-serif; fill: #7f8c8d; }
      .status { font: bold 12px sans-serif; }
    </style>
    <linearGradient id="provider-grad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="caseworker-grad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#27ae60;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#229954;stop-opacity:1" />
    </linearGradient>
    <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3498db" />
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60" />
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">End-to-End User Workflow</text>
  <text x="700" y="70" text-anchor="middle" class="subtitle">Provider Creates Timesheet → Case Worker Approves</text>
  
  <!-- Provider Column Header -->
  <rect x="50" y="100" width="600" height="50" rx="8" fill="url(#provider-grad)" />
  <text x="350" y="132" text-anchor="middle" class="role-title">PROVIDER WORKFLOW</text>
  
  <!-- Case Worker Column Header -->
  <rect x="750" y="100" width="600" height="50" rx="8" fill="url(#caseworker-grad)" />
  <text x="1050" y="132" text-anchor="middle" class="role-title">CASE WORKER WORKFLOW</text>
  
  <!-- Vertical Divider -->
  <line x1="700" y1="100" x2="700" y2="850" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5" />
  
  <!-- Provider Step 1: Login -->
  <rect x="100" y="180" width="500" height="80" rx="8" fill="#ecf0f1" stroke="#3498db" stroke-width="2" />
  <text x="350" y="205" text-anchor="middle" class="step-title">Step 1: Provider Logs In</text>
  <text x="120" y="230" class="text">✓ Enters credentials (username/password)</text>
  <text x="120" y="248" class="text">✓ Keycloak authenticates and issues JWT token</text>
  <text x="350" y="268" text-anchor="middle" class="small-text">Role: PROVIDER | Token Valid: 1 hour</text>
  
  <!-- Arrow Down -->
  <path d="M 350 260 L 350 290" stroke="#3498db" stroke-width="3" marker-end="url(#arrow-blue)" />
  
  <!-- Provider Step 2: Dashboard -->
  <rect x="100" y="290" width="500" height="90" rx="8" fill="#ecf0f1" stroke="#3498db" stroke-width="2" />
  <text x="350" y="315" text-anchor="middle" class="step-title">Step 2: Views Dashboard</text>
  <text x="120" y="340" class="text">✓ System checks permissions with Keycloak</text>
  <text x="120" y="358" class="text">✓ Queries allowed actions: create, edit, delete</text>
  <text x="120" y="376" class="text">✓ Displays only authorized UI elements</text>
  
  <!-- Arrow Down -->
  <path d="M 350 380 L 350 410" stroke="#3498db" stroke-width="3" marker-end="url(#arrow-blue)" />
  
  <!-- Provider Step 3: Create Timesheet -->
  <rect x="100" y="410" width="500" height="110" rx="8" fill="#ecf0f1" stroke="#3498db" stroke-width="2" />
  <text x="350" y="435" text-anchor="middle" class="step-title">Step 3: Creates Timesheet</text>
  <text x="120" y="460" class="text">✓ Fills form with work details:</text>
  <text x="140" y="478" class="small-text">• Employee Name, Location, Date Range</text>
  <text x="140" y="493" class="small-text">• Regular Hours: 80, Overtime: 10</text>
  <text x="140" y="508" class="small-text">• Comments: "Normal work period"</text>
  
  <!-- Arrow Down -->
  <path d="M 350 520 L 350 550" stroke="#3498db" stroke-width="3" marker-end="url(#arrow-blue)" />
  
  <!-- Provider Step 4: Submit -->
  <rect x="100" y="550" width="500" height="120" rx="8" fill="#d5f4e6" stroke="#27ae60" stroke-width="3" />
  <text x="350" y="575" text-anchor="middle" class="step-title">Step 4: Submits Timesheet</text>
  <text x="120" y="600" class="text">✓ Backend applies field filtering (create scope)</text>
  <text x="120" y="618" class="text">✓ Only allowed fields processed: name, hours, location</text>
  <text x="120" y="636" class="text">✓ Timesheet saved with Status: SUBMITTED</text>
  <text x="120" y="654" class="text">✓ Notification sent to Case Worker</text>
  
  <!-- Arrow Across to Case Worker -->
  <path d="M 600 610 L 750 610" stroke="#e67e22" stroke-width="4" marker-end="url(#arrow-red)" stroke-dasharray="8,4" />
  <text x="675" y="605" text-anchor="middle" class="text" fill="#e67e22" font-weight="bold">Notification</text>
  
  <!-- Provider Step 5: Wait -->
  <rect x="100" y="700" width="500" height="60" rx="8" fill="#fff3cd" stroke="#f39c12" stroke-width="2" />
  <text x="350" y="730" text-anchor="middle" class="step-title">Step 5: Awaits Approval</text>
  <text x="350" y="750" text-anchor="middle" class="small-text">Status: SUBMITTED (Cannot edit or delete)</text>
  
  <!-- Case Worker Step 1: Login -->
  <rect x="800" y="180" width="500" height="80" rx="8" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" />
  <text x="1050" y="205" text-anchor="middle" class="step-title">Step 1: Case Worker Logs In</text>
  <text x="820" y="230" class="text">✓ Authenticates with Keycloak</text>
  <text x="820" y="248" class="text">✓ Receives JWT token with CASE_WORKER role</text>
  <text x="1050" y="268" text-anchor="middle" class="small-text">Full access to all submitted timesheets</text>
  
  <!-- Arrow Down -->
  <path d="M 1050 260 L 1050 290" stroke="#27ae60" stroke-width="3" marker-end="url(#arrow-green)" />
  
  <!-- Case Worker Step 2: Dashboard -->
  <rect x="800" y="290" width="500" height="80" rx="8" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" />
  <text x="1050" y="315" text-anchor="middle" class="step-title">Step 2: Views Dashboard</text>
  <text x="820" y="340" class="text">✓ Sees notification: "1 Pending Approval"</text>
  <text x="820" y="358" class="text">✓ Actions available: approve, reject, request revision</text>
  
  <!-- Arrow Down -->
  <path d="M 1050 370 L 1050 400" stroke="#27ae60" stroke-width="3" marker-end="url(#arrow-green)" />
  
  <!-- Case Worker Step 3: Review -->
  <rect x="800" y="400" width="500" height="100" rx="8" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" />
  <text x="1050" y="425" text-anchor="middle" class="step-title">Step 3: Reviews Timesheet</text>
  <text x="820" y="450" class="text">✓ Views ALL fields (full access):</text>
  <text x="840" y="468" class="small-text">• Provider, Hours, Location, Comments</text>
  <text x="840" y="483" class="small-text">• Submission Date, Status, History</text>
  
  <!-- Arrow Down -->
  <path d="M 1050 500 L 1050 530" stroke="#27ae60" stroke-width="3" marker-end="url(#arrow-green)" />
  
  <!-- Case Worker Step 4: Decision -->
  <rect x="800" y="530" width="500" height="130" rx="8" fill="#d5f4e6" stroke="#27ae60" stroke-width="3" />
  <text x="1050" y="555" text-anchor="middle" class="step-title">Step 4: Makes Decision - APPROVE</text>
  <text x="820" y="580" class="text">✓ Adds supervisor comments: "Approved after review"</text>
  <text x="820" y="598" class="text">✓ Backend applies field filtering (approve scope)</text>
  <text x="820" y="616" class="text">✓ Only supervisorComments field processed</text>
  <text x="820" y="634" class="text">✓ Status updated: APPROVED</text>
  <text x="820" y="652" class="text">✓ Notification sent to Provider</text>
  
  <!-- Arrow Back to Provider -->
  <path d="M 800 590 L 650 590" stroke="#27ae60" stroke-width="4" marker-end="url(#arrow-green)" stroke-dasharray="8,4" />
  <text x="725" y="585" text-anchor="middle" class="text" fill="#27ae60" font-weight="bold">Approved</text>
  
  <!-- Provider Final Step -->
  <rect x="100" y="790" width="500" height="60" rx="8" fill="#d5f4e6" stroke="#27ae60" stroke-width="3" />
  <text x="350" y="817" text-anchor="middle" class="step-title">✓ Receives Approval Notification</text>
  <text x="350" y="840" text-anchor="middle" class="status" fill="#27ae60">STATUS: APPROVED ✓</text>
  
  <!-- Case Worker Final Step -->
  <rect x="800" y="700" width="500" height="60" rx="8" fill="#d5f4e6" stroke="#27ae60" stroke-width="3" />
  <text x="1050" y="727" text-anchor="middle" class="step-title">✓ Approval Recorded</text>
  <text x="1050" y="750" text-anchor="middle" class="small-text">Complete audit trail: Who, What, When</text>
  
  <!-- Timeline indicator -->
  <text x="50" y="190" class="small-text" fill="#3498db">Time: T+0</text>
  <text x="50" y="300" class="small-text" fill="#3498db">T+1 min</text>
  <text x="50" y="420" class="small-text" fill="#3498db">T+3 min</text>
  <text x="50" y="560" class="small-text" fill="#3498db">T+5 min</text>
  <text x="50" y="800" class="small-text" fill="#27ae60">T+30 min</text>
  
  <text x="1350" y="190" class="small-text" fill="#27ae60">T+10 min</text>
  <text x="1350" y="300" class="small-text" fill="#27ae60">T+11 min</text>
  <text x="1350" y="410" class="small-text" fill="#27ae60">T+12 min</text>
  <text x="1350" y="540" class="small-text" fill="#27ae60">T+15 min</text>
  
  <!-- Legend -->
  <rect x="50" y="870" width="20" height="15" fill="#3498db" />
  <text x="80" y="882" class="small-text">Provider Actions</text>
  
  <rect x="250" y="870" width="20" height="15" fill="#27ae60" />
  <text x="280" y="882" class="small-text">Case Worker Actions</text>
  
  <rect x="450" y="870" width="20" height="15" fill="#d5f4e6" stroke="#27ae60" stroke-width="2" />
  <text x="480" y="882" class="small-text">Success/Approved</text>
  
  <rect x="700" y="870" width="20" height="15" fill="#fff3cd" stroke="#f39c12" stroke-width="2" />
  <text x="730" y="882" class="small-text">Waiting State</text>
</svg>


