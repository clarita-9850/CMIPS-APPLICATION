<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900">
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    <linearGradient id="keycloakGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7c3aed"/>
      <stop offset="100%" style="stop-color:#5b21b6"/>
    </linearGradient>
    <linearGradient id="appGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0ea5e9"/>
      <stop offset="100%" style="stop-color:#0369a1"/>
    </linearGradient>
    <linearGradient id="postgresGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#336791"/>
      <stop offset="100%" style="stop-color:#264d73"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="shadow">
      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 L3,6 Z" fill="#fbbf24"/>
    </marker>
    <marker id="arrowBlue" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 L3,6 Z" fill="#60a5fa"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="900" fill="url(#bgGradient)"/>

  <!-- Grid pattern -->
  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#334155" stroke-width="0.5" opacity="0.3"/>
  </pattern>
  <rect width="1200" height="900" fill="url(#grid)"/>

  <!-- Title -->
  <text x="600" y="50" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white" text-anchor="middle">CMIPS Database Architecture</text>
  <text x="600" y="80" font-family="Arial, sans-serif" font-size="14" fill="#94a3b8" text-anchor="middle">PostgreSQL 15 | Two-Schema Design | Unified Database</text>

  <!-- PostgreSQL Container -->
  <rect x="50" y="110" width="1100" height="740" rx="20" fill="none" stroke="url(#postgresGradient)" stroke-width="3" stroke-dasharray="10,5"/>
  <rect x="50" y="110" width="200" height="40" rx="10" fill="url(#postgresGradient)"/>
  <text x="150" y="136" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">PostgreSQL 15</text>
  <text x="600" y="145" font-family="Arial, sans-serif" font-size="12" fill="#64748b" text-anchor="middle">Database: cmips_mvp | Port: 5432</text>

  <!-- ==================== KEYCLOAK SCHEMA ==================== -->
  <g filter="url(#shadow)">
    <rect x="80" y="180" width="480" height="640" rx="16" fill="#1e1b4b" stroke="#7c3aed" stroke-width="2"/>
    <!-- Header -->
    <rect x="80" y="180" width="480" height="50" rx="16" fill="url(#keycloakGradient)"/>
    <rect x="80" y="210" width="480" height="20" fill="url(#keycloakGradient)"/>
    <text x="320" y="212" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white" text-anchor="middle">KEYCLOAK SCHEMA</text>

    <!-- Schema description -->
    <text x="320" y="255" font-family="Arial, sans-serif" font-size="11" fill="#a78bfa" text-anchor="middle">Identity &amp; Access Management</text>

    <!-- Keycloak Tables -->
    <g font-family="Arial, sans-serif" font-size="11" fill="#e2e8f0">
      <!-- Users & Authentication -->
      <rect x="100" y="275" width="200" height="130" rx="8" fill="#2e1065" stroke="#8b5cf6" stroke-width="1"/>
      <text x="200" y="295" font-size="12" font-weight="bold" fill="#c4b5fd" text-anchor="middle">Users &amp; Authentication</text>
      <text x="115" y="315" fill="#a5b4fc">• user_entity</text>
      <text x="115" y="332" fill="#a5b4fc">• credential</text>
      <text x="115" y="349" fill="#a5b4fc">• user_attribute</text>
      <text x="115" y="366" fill="#a5b4fc">• user_session</text>
      <text x="115" y="383" fill="#a5b4fc">• federated_identity</text>

      <!-- Realms -->
      <rect x="320" y="275" width="220" height="130" rx="8" fill="#2e1065" stroke="#8b5cf6" stroke-width="1"/>
      <text x="430" y="295" font-size="12" font-weight="bold" fill="#c4b5fd" text-anchor="middle">Realms &amp; Clients</text>
      <text x="335" y="315" fill="#a5b4fc">• realm</text>
      <text x="335" y="332" fill="#a5b4fc">• client</text>
      <text x="335" y="349" fill="#a5b4fc">• client_scope</text>
      <text x="335" y="366" fill="#a5b4fc">• redirect_uris</text>
      <text x="335" y="383" fill="#a5b4fc">• protocol_mapper</text>

      <!-- Roles & Permissions -->
      <rect x="100" y="420" width="200" height="130" rx="8" fill="#2e1065" stroke="#8b5cf6" stroke-width="1"/>
      <text x="200" y="440" font-size="12" font-weight="bold" fill="#c4b5fd" text-anchor="middle">Roles &amp; Permissions</text>
      <text x="115" y="460" fill="#a5b4fc">• keycloak_role</text>
      <text x="115" y="477" fill="#a5b4fc">• user_role_mapping</text>
      <text x="115" y="494" fill="#a5b4fc">• role_attribute</text>
      <text x="115" y="511" fill="#a5b4fc">• composite_role</text>
      <text x="115" y="528" fill="#a5b4fc">• scope_mapping</text>

      <!-- Groups -->
      <rect x="320" y="420" width="220" height="130" rx="8" fill="#2e1065" stroke="#8b5cf6" stroke-width="1"/>
      <text x="430" y="440" font-size="12" font-weight="bold" fill="#c4b5fd" text-anchor="middle">Groups (58 Counties)</text>
      <text x="335" y="460" fill="#a5b4fc">• keycloak_group</text>
      <text x="335" y="477" fill="#a5b4fc">• group_attribute</text>
      <text x="335" y="494" fill="#a5b4fc">• group_role_mapping</text>
      <text x="335" y="511" fill="#a5b4fc">• user_group_membership</text>
      <text x="335" y="528" fill="#a5b4fc">• default_client_scope</text>

      <!-- Authorization -->
      <rect x="100" y="565" width="440" height="95" rx="8" fill="#2e1065" stroke="#8b5cf6" stroke-width="1"/>
      <text x="320" y="585" font-size="12" font-weight="bold" fill="#c4b5fd" text-anchor="middle">Authorization Services (PBAC)</text>
      <text x="115" y="608" fill="#a5b4fc">• resource_server</text>
      <text x="115" y="625" fill="#a5b4fc">• resource_server_resource</text>
      <text x="115" y="642" fill="#a5b4fc">• resource_server_scope</text>
      <text x="320" y="608" fill="#a5b4fc">• resource_server_policy</text>
      <text x="320" y="625" fill="#a5b4fc">• resource_server_perm_ticket</text>
      <text x="320" y="642" fill="#a5b4fc">• policy_config</text>
    </g>

    <!-- Keycloak Stats -->
    <rect x="100" y="675" width="440" height="35" rx="6" fill="#4c1d95"/>
    <text x="320" y="698" font-family="Arial, sans-serif" font-size="11" fill="#ddd6fe" text-anchor="middle">~90+ tables | Realm: cmips | Managed by Keycloak</text>
  </g>

  <!-- ==================== APPLICATION SCHEMA ==================== -->
  <g filter="url(#shadow)">
    <rect x="640" y="180" width="480" height="640" rx="16" fill="#0c1e3d" stroke="#0ea5e9" stroke-width="2"/>
    <!-- Header -->
    <rect x="640" y="180" width="480" height="50" rx="16" fill="url(#appGradient)"/>
    <rect x="640" y="210" width="480" height="20" fill="url(#appGradient)"/>
    <text x="880" y="212" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white" text-anchor="middle">APPLICATION SCHEMA</text>

    <!-- Schema description -->
    <text x="880" y="255" font-family="Arial, sans-serif" font-size="11" fill="#7dd3fc" text-anchor="middle">Business Data &amp; Operations</text>

    <!-- Application Tables -->
    <g font-family="Arial, sans-serif" font-size="11" fill="#e2e8f0">
      <!-- Core Entities -->
      <rect x="660" y="275" width="200" height="110" rx="8" fill="#082f49" stroke="#38bdf8" stroke-width="1"/>
      <text x="760" y="295" font-size="12" font-weight="bold" fill="#7dd3fc" text-anchor="middle">Core Entities</text>
      <text x="675" y="318" fill="#bae6fd">• persons</text>
      <text x="675" y="335" fill="#94a3b8" font-size="10">  Demographics, SSN, Address</text>
      <text x="675" y="355" fill="#bae6fd">• provider_recipient_</text>
      <text x="675" y="370" fill="#bae6fd">  relationships</text>

      <!-- Timesheets & EVV -->
      <rect x="880" y="275" width="220" height="110" rx="8" fill="#082f49" stroke="#38bdf8" stroke-width="1"/>
      <text x="990" y="295" font-size="12" font-weight="bold" fill="#7dd3fc" text-anchor="middle">Timesheets &amp; EVV</text>
      <text x="895" y="318" fill="#bae6fd">• timesheets</text>
      <text x="895" y="335" fill="#94a3b8" font-size="10">  Hours, Status, Approval</text>
      <text x="895" y="355" fill="#bae6fd">• evv_records</text>
      <text x="895" y="370" fill="#94a3b8" font-size="10">  GPS, Check-in/out, Violations</text>

      <!-- Work Management -->
      <rect x="660" y="400" width="200" height="110" rx="8" fill="#082f49" stroke="#38bdf8" stroke-width="1"/>
      <text x="760" y="420" font-size="12" font-weight="bold" fill="#7dd3fc" text-anchor="middle">Work Management</text>
      <text x="675" y="443" fill="#bae6fd">• tasks</text>
      <text x="675" y="460" fill="#94a3b8" font-size="10">  Work items, Queue, Priority</text>
      <text x="675" y="480" fill="#bae6fd">• work_queue_subscriptions</text>
      <text x="675" y="497" fill="#94a3b8" font-size="10">  User-Queue assignments</text>

      <!-- Notifications -->
      <rect x="880" y="400" width="220" height="110" rx="8" fill="#082f49" stroke="#38bdf8" stroke-width="1"/>
      <text x="990" y="420" font-size="12" font-weight="bold" fill="#7dd3fc" text-anchor="middle">Notifications</text>
      <text x="895" y="443" fill="#bae6fd">• notifications</text>
      <text x="895" y="460" fill="#94a3b8" font-size="10">  Alerts, Messages, Read status</text>
      <text x="895" y="480" fill="#64748b" font-size="10">  Types: INFO, WARNING,</text>
      <text x="895" y="495" fill="#64748b" font-size="10">  ALERT, SUCCESS</text>

      <!-- Reporting -->
      <rect x="660" y="525" width="440" height="95" rx="8" fill="#082f49" stroke="#38bdf8" stroke-width="1"/>
      <text x="880" y="545" font-size="12" font-weight="bold" fill="#7dd3fc" text-anchor="middle">Batch Reporting &amp; Jobs</text>
      <text x="675" y="570" fill="#bae6fd">• report_jobs</text>
      <text x="675" y="587" fill="#94a3b8" font-size="10">  Job queue, Progress tracking, Retry logic</text>
      <text x="675" y="604" fill="#94a3b8" font-size="10">  Formats: PDF, CSV, JSON, XML | Self-referencing for job chains</text>
    </g>

    <!-- Relationships Box -->
    <rect x="660" y="635" width="440" height="70" rx="8" fill="#0c4a6e" stroke="#0284c7" stroke-width="1"/>
    <text x="880" y="655" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7dd3fc" text-anchor="middle">Relationships</text>
    <text x="675" y="675" font-family="Arial, sans-serif" font-size="10" fill="#bae6fd">• timesheets → evv_records (1:N)</text>
    <text x="675" y="692" font-family="Arial, sans-serif" font-size="10" fill="#bae6fd">• report_jobs → report_jobs (self-ref for job chains)</text>
    <text x="920" y="675" font-family="Arial, sans-serif" font-size="10" fill="#bae6fd">• Polymorphic: tasks, notifications</text>
    <text x="920" y="692" font-family="Arial, sans-serif" font-size="10" fill="#bae6fd">• Soft refs via String IDs</text>

    <!-- Application Stats -->
    <rect x="660" y="720" width="440" height="35" rx="6" fill="#0369a1"/>
    <text x="880" y="743" font-family="Arial, sans-serif" font-size="11" fill="#e0f2fe" text-anchor="middle">8 tables | Managed by Spring Data JPA | Hibernate auto-update</text>
  </g>

  <!-- ==================== CONNECTION BETWEEN SCHEMAS ==================== -->
  <!-- JWT Token Flow -->
  <g filter="url(#glow)">
    <path d="M 560 400 C 600 400, 600 400, 640 400" stroke="#fbbf24" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
    <path d="M 640 430 C 600 430, 600 430, 560 430" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowBlue)"/>
  </g>

  <!-- Connection Label Box -->
  <rect x="555" y="340" width="90" height="140" rx="10" fill="#1e293b" stroke="#fbbf24" stroke-width="2"/>
  <text x="600" y="365" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#fbbf24" text-anchor="middle">CONNECTION</text>

  <text x="600" y="390" font-family="Arial, sans-serif" font-size="9" fill="#fbbf24" text-anchor="middle">JWT Token →</text>
  <text x="600" y="405" font-family="Arial, sans-serif" font-size="8" fill="#94a3b8" text-anchor="middle">user_id</text>
  <text x="600" y="418" font-family="Arial, sans-serif" font-size="8" fill="#94a3b8" text-anchor="middle">roles[]</text>
  <text x="600" y="431" font-family="Arial, sans-serif" font-size="8" fill="#94a3b8" text-anchor="middle">groups[]</text>

  <text x="600" y="455" font-family="Arial, sans-serif" font-size="9" fill="#60a5fa" text-anchor="middle">← Auth Check</text>
  <text x="600" y="470" font-family="Arial, sans-serif" font-size="8" fill="#94a3b8" text-anchor="middle">Policy eval</text>

  <!-- ==================== BOTTOM INFO SECTION ==================== -->
  <!-- How They Connect -->
  <rect x="80" y="835" width="1040" height="50" rx="10" fill="#1e293b" stroke="#475569" stroke-width="1"/>
  <text x="600" y="858" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">How Schemas Connect</text>
  <text x="200" y="875" font-family="Arial, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">No direct FK between schemas</text>
  <text x="450" y="875" font-family="Arial, sans-serif" font-size="10" fill="#fbbf24" text-anchor="middle">JWT carries user_id + roles + groups</text>
  <text x="720" y="875" font-family="Arial, sans-serif" font-size="10" fill="#7dd3fc" text-anchor="middle">App stores user_id as VARCHAR</text>
  <text x="980" y="875" font-family="Arial, sans-serif" font-size="10" fill="#a78bfa" text-anchor="middle">Runtime auth via Keycloak API</text>

</svg>