<svg width="1400" height="2000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="keycloakGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1e3a8a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="frontendGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#046b99;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#035376;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="backendGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#047857;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Title -->
  <text x="700" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    CMIPS Dashboard Architecture: Role-Based &amp; County-Based Rendering
  </text>
  
  <!-- Phase 1: User Login -->
  <rect x="50" y="60" width="1300" height="180" rx="10" fill="#f0f9ff" stroke="#1e3a8a" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="85" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#1e3a8a">
    Phase 1: User Authentication &amp; Token Generation
  </text>
  
  <!-- User -->
  <rect x="100" y="110" width="120" height="100" rx="8" fill="#e0f2fe" stroke="#0284c7" stroke-width="2"/>
  <text x="160" y="135" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#0c4a6e">User</text>
  <text x="160" y="155" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#075985">Username</text>
  <text x="160" y="170" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#075985">Password</text>
  <text x="160" y="185" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#075985">Role: ADMIN/</text>
  <text x="160" y="200" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#075985">SUPERVISOR/etc</text>
  
  <!-- Arrow 1 -->
  <path d="M 220 160 L 280 160" stroke="#1e3a8a" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Keycloak -->
  <rect x="300" y="110" width="200" height="100" rx="8" fill="url(#keycloakGrad)" stroke="#1e3a8a" stroke-width="2"/>
  <text x="400" y="135" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Keycloak</text>
  <text x="400" y="155" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Authentication</text>
  <text x="400" y="170" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Authorization</text>
  <text x="400" y="185" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Groups: CTA/CTB/CTC</text>
  <text x="400" y="200" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Roles: ADMIN/etc</text>
  
  <!-- Arrow 2 -->
  <path d="M 500 160 L 560 160" stroke="#1e3a8a" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- JWT Token -->
  <rect x="580" y="110" width="250" height="100" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="705" y="135" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#92400e">JWT Token</text>
  <text x="705" y="155" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">Header: Algorithm, Type</text>
  <text x="705" y="170" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">Payload:</text>
  <text x="705" y="185" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">• roles: ["ADMIN"]</text>
  <text x="705" y="200" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">• groups: ["CTA"]</text>
  
  <!-- Arrow 3 -->
  <path d="M 830 160 L 890 160" stroke="#1e3a8a" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Frontend AuthContext -->
  <rect x="910" y="110" width="200" height="100" rx="8" fill="url(#frontendGrad)" stroke="#046b99" stroke-width="2"/>
  <text x="1010" y="135" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">AuthContext</text>
  <text x="1010" y="155" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Decode JWT</text>
  <text x="1010" y="170" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Extract Role</text>
  <text x="1010" y="185" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Extract County</text>
  <text x="1010" y="200" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Store in State</text>
  
  <!-- Phase 2: Theme Selection -->
  <rect x="50" y="280" width="1300" height="200" rx="10" fill="#f0fdf4" stroke="#059669" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="305" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#059669">
    Phase 2: County-Based Theme Selection
  </text>
  
  <!-- CountyThemeContext -->
  <rect x="100" y="330" width="250" height="120" rx="8" fill="url(#frontendGrad)" stroke="#046b99" stroke-width="2"/>
  <text x="225" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">CountyThemeContext</text>
  <text x="225" y="375" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Reads: user.county</text>
  <text x="225" y="390" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">Maps County → Theme:</text>
  <text x="225" y="405" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">CTA → Sacramento</text>
  <text x="225" y="420" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">CTB → Orange County</text>
  <text x="225" y="435" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">CTC → Shasta</text>
  
  <!-- Arrow 4 -->
  <path d="M 350 390 L 410 390" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Theme CSS Loader -->
  <rect x="430" y="330" width="200" height="120" rx="8" fill="#d1fae5" stroke="#059669" stroke-width="2"/>
  <text x="530" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">Theme CSS Loader</text>
  <text x="530" y="375" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">Dynamically loads:</text>
  <text x="530" y="390" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">/cagov/css/</text>
  <text x="530" y="405" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">colortheme-</text>
  <text x="530" y="420" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">sacramento.min.css</text>
  <text x="530" y="435" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">(or orangecounty/shasta)</text>
  
  <!-- Arrow 5 -->
  <path d="M 630 390 L 690 390" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- CSS Variables Applied -->
  <rect x="710" y="330" width="200" height="120" rx="8" fill="#bbf7d0" stroke="#059669" stroke-width="2"/>
  <text x="810" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">CSS Variables</text>
  <text x="810" y="375" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">Applied to DOM:</text>
  <text x="810" y="390" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">--color-p2: #153554</text>
  <text x="810" y="405" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">(Sacramento Blue)</text>
  <text x="810" y="420" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">or #A15801 (Orange)</text>
  <text x="810" y="435" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">or #336c39 (Shasta)</text>
  
  <!-- Arrow 6 -->
  <path d="M 910 390 L 970 390" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Global Theme Applied -->
  <rect x="990" y="330" width="200" height="120" rx="8" fill="#86efac" stroke="#059669" stroke-width="2"/>
  <text x="1090" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">Global Theme</text>
  <text x="1090" y="375" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">All components use</text>
  <text x="1090" y="390" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">county-specific</text>
  <text x="1090" y="405" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">colors, fonts,</text>
  <text x="1090" y="420" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">buttons, forms,</text>
  <text x="1090" y="435" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">tables, etc.</text>
  
  <!-- Phase 3: Role-Based Routing -->
  <rect x="50" y="520" width="1300" height="280" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="545" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#d97706">
    Phase 3: Role-Based Dashboard Routing
  </text>
  
  <!-- HomePage Router -->
  <rect x="100" y="570" width="200" height="200" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="200" y="595" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#92400e">HomePage</text>
  <text x="200" y="615" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">(app/page.tsx)</text>
  <text x="200" y="635" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">Reads: user.role</text>
  <text x="200" y="655" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">Routes to:</text>
  <text x="200" y="675" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">• ADMIN → /admin</text>
  <text x="200" y="695" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">• SUPERVISOR → /supervisor</text>
  <text x="200" y="715" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">• CASE_WORKER → /caseworker</text>
  <text x="200" y="735" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">• PROVIDER → /provider</text>
  <text x="200" y="755" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">• RECIPIENT → /recipient</text>
  
  <!-- Arrows to Dashboards -->
  <path d="M 300 620 L 360 620" stroke="#d97706" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 300 650 L 360 650" stroke="#d97706" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 300 680 L 360 680" stroke="#d97706" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 300 710 L 360 710" stroke="#d97706" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 300 740 L 360 740" stroke="#d97706" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Dashboard Components -->
  <rect x="380" y="560" width="220" height="50" rx="8" fill="#fde68a" stroke="#d97706" stroke-width="2"/>
  <text x="490" y="585" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#78350f">Admin Dashboard</text>
  <text x="490" y="600" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">/admin/keycloak</text>
  
  <rect x="380" y="620" width="220" height="50" rx="8" fill="#fde68a" stroke="#d97706" stroke-width="2"/>
  <text x="490" y="645" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#78350f">Supervisor Dashboard</text>
  <text x="490" y="660" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">/supervisor/dashboard</text>
  
  <rect x="380" y="680" width="220" height="50" rx="8" fill="#fde68a" stroke="#d97706" stroke-width="2"/>
  <text x="490" y="705" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#78350f">Caseworker Dashboard</text>
  <text x="490" y="720" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">/caseworker/dashboard</text>
  
  <rect x="620" y="560" width="220" height="50" rx="8" fill="#fde68a" stroke="#d97706" stroke-width="2"/>
  <text x="730" y="585" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#78350f">Provider Dashboard</text>
  <text x="730" y="600" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">/provider/dashboard</text>
  
  <rect x="620" y="620" width="220" height="50" rx="8" fill="#fde68a" stroke="#d97706" stroke-width="2"/>
  <text x="730" y="645" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#78350f">Recipient Dashboard</text>
  <text x="730" y="660" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">/recipient/dashboard</text>
  
  <!-- Role Protection Note -->
  <rect x="860" y="570" width="200" height="200" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="960" y="595" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#92400e">Role Protection</text>
  <text x="960" y="615" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">Each dashboard</text>
  <text x="960" y="630" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">checks user.role</text>
  <text x="960" y="645" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">on mount:</text>
  <text x="960" y="665" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">if (role !== 'ADMIN')</text>
  <text x="960" y="680" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">→ redirect('/login')</text>
  <text x="960" y="700" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">else</text>
  <text x="960" y="715" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">→ load dashboard</text>
  <text x="960" y="735" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">data</text>
  <text x="960" y="750" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#78350f">(useEffect hook)</text>
  
  <!-- Phase 4: Data Fetching -->
  <rect x="50" y="840" width="1300" height="240" rx="10" fill="#f0f9ff" stroke="#0284c7" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="865" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#0284c7">
    Phase 4: Dashboard Data Fetching
  </text>
  
  <!-- Dashboard Component -->
  <rect x="100" y="890" width="200" height="160" rx="8" fill="url(#frontendGrad)" stroke="#046b99" stroke-width="2"/>
  <text x="200" y="915" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Dashboard Component</text>
  <text x="200" y="935" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">(e.g., Supervisor)</text>
  <text x="200" y="955" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">useEffect triggers:</text>
  <text x="200" y="975" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">• loadDashboardData()</text>
  <text x="200" y="995" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">• loadAnalytics()</text>
  <text x="200" y="1015" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">• loadBatchJobs()</text>
  <text x="200" y="1035" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0f2fe">• etc.</text>
  
  <!-- Arrow 7 -->
  <path d="M 300 970 L 360 970" stroke="#0284c7" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- API Client -->
  <rect x="380" y="890" width="180" height="160" rx="8" fill="#bfdbfe" stroke="#0284c7" stroke-width="2"/>
  <text x="470" y="915" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e40af">API Client</text>
  <text x="470" y="935" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">(lib/api.ts)</text>
  <text x="470" y="955" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Adds JWT token</text>
  <text x="470" y="975" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">to headers:</text>
  <text x="470" y="995" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Authorization:</text>
  <text x="470" y="1015" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Bearer {token}</text>
  <text x="470" y="1035" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Base URL: /api</text>
  
  <!-- Arrow 8 -->
  <path d="M 560 970 L 620 970" stroke="#0284c7" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Spring Boot Backend -->
  <rect x="640" y="890" width="200" height="160" rx="8" fill="url(#backendGrad)" stroke="#059669" stroke-width="2"/>
  <text x="740" y="915" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Spring Boot Backend</text>
  <text x="740" y="935" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#d1fae5">Validates JWT</text>
  <text x="740" y="955" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#d1fae5">Extracts role &amp; county</text>
  <text x="740" y="975" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#d1fae5">Applies filters:</text>
  <text x="740" y="995" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#d1fae5">• Role-based access</text>
  <text x="740" y="1015" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#d1fae5">• County-based data</text>
  <text x="740" y="1035" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#d1fae5">• Field masking</text>
  
  <!-- Arrow 9 -->
  <path d="M 840 970 L 900 970" stroke="#0284c7" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Database -->
  <rect x="920" y="890" width="180" height="160" rx="8" fill="#cfe2ff" stroke="#0284c7" stroke-width="2"/>
  <text x="1010" y="915" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e40af">PostgreSQL</text>
  <text x="1010" y="935" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Database</text>
  <text x="1010" y="955" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Queries filtered by:</text>
  <text x="1010" y="975" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">• User role</text>
  <text x="1010" y="995" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">• County code</text>
  <text x="1010" y="1015" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">• Permissions</text>
  <text x="1010" y="1035" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Returns JSON data</text>
  
  <!-- Response Flow -->
  <path d="M 1010 1050 L 1010 1080 L 740 1080 L 740 1050" stroke="#0284c7" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
  <path d="M 640 1050 L 600 1050 L 600 1100 L 300 1100 L 300 1050" stroke="#0284c7" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
  <text x="600" y="1095" font-family="Arial, sans-serif" font-size="10" fill="#0284c7">JSON Response</text>
  
  <!-- Phase 5: Rendering -->
  <rect x="50" y="1120" width="1300" height="320" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="1145" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#d97706">
    Phase 5: Dashboard Rendering with County Theme
  </text>
  
  <!-- React Component Tree -->
  <rect x="100" y="1170" width="280" height="240" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="240" y="1195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#92400e">React Component Tree</text>
  
  <rect x="120" y="1210" width="240" height="30" rx="4" fill="#fde68a" stroke="#d97706" stroke-width="1"/>
  <text x="240" y="1230" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">RootLayout (layout.tsx)</text>
  
  <rect x="120" y="1250" width="240" height="30" rx="4" fill="#fde68a" stroke="#d97706" stroke-width="1"/>
  <text x="240" y="1270" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">AuthProvider</text>
  
  <rect x="120" y="1290" width="240" height="30" rx="4" fill="#fde68a" stroke="#d97706" stroke-width="1"/>
  <text x="240" y="1310" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">CountyThemeProvider</text>
  
  <rect x="120" y="1330" width="240" height="30" rx="4" fill="#fde68a" stroke="#d97706" stroke-width="1"/>
  <text x="240" y="1350" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">Dashboard Page Component</text>
  
  <rect x="120" y="1370" width="240" height="30" rx="4" fill="#fde68a" stroke="#d97706" stroke-width="1"/>
  <text x="240" y="1390" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#78350f">UI Components (tables, forms)</text>
  
  <!-- Theme Application -->
  <rect x="420" y="1170" width="280" height="240" rx="8" fill="#d1fae5" stroke="#059669" stroke-width="2"/>
  <text x="560" y="1195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">Theme Application</text>
  
  <rect x="440" y="1210" width="240" height="50" rx="4" fill="#86efac" stroke="#059669" stroke-width="1"/>
  <text x="560" y="1230" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">CSS Variables Applied:</text>
  <text x="560" y="1245" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">--color-p2: #153554 (Sacramento)</text>
  <text x="560" y="1255" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">or #A15801 (Orange) or #336c39 (Shasta)</text>
  
  <rect x="440" y="1270" width="240" height="50" rx="4" fill="#86efac" stroke="#059669" stroke-width="1"/>
  <text x="560" y="1290" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">All Components Use:</text>
  <text x="560" y="1305" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">• Buttons: var(--color-p2)</text>
  <text x="560" y="1315" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">• Headers: var(--color-p2)</text>
  
  <rect x="440" y="1330" width="240" height="50" rx="4" fill="#86efac" stroke="#059669" stroke-width="1"/>
  <text x="560" y="1350" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#047857">CA.gov Template:</text>
  <text x="560" y="1365" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">• Forms, tables, links</text>
  <text x="560" y="1375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">• Alerts, messages</text>
  
  <rect x="440" y="1390" width="240" height="20" rx="4" fill="#86efac" stroke="#059669" stroke-width="1"/>
  <text x="560" y="1405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#047857">Consistent styling across all pages</text>
  
  <!-- Final Output -->
  <rect x="740" y="1170" width="280" height="240" rx="8" fill="#f0f9ff" stroke="#0284c7" stroke-width="2"/>
  <text x="880" y="1195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e40af">Final Rendered Dashboard</text>
  
  <rect x="760" y="1210" width="240" height="80" rx="4" fill="#bfdbfe" stroke="#0284c7" stroke-width="1"/>
  <text x="880" y="1230" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Header with county theme</text>
  <text x="880" y="1245" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1e3a8a">• Logo, navigation</text>
  <text x="880" y="1260" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1e3a8a">• Welcome message</text>
  <text x="880" y="1275" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1e3a8a">• Logout button</text>
  <text x="880" y="1285" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1e3a8a">(all in county colors)</text>
  
  <rect x="760" y="1300" width="240" height="50" rx="4" fill="#bfdbfe" stroke="#0284c7" stroke-width="1"/>
  <text x="880" y="1320" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Role-specific content:</text>
  <text x="880" y="1335" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1e3a8a">• Supervisor: Analytics, Batch Jobs</text>
  <text x="880" y="1345" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1e3a8a">• Provider: Timesheets, Recipients</text>
  
  <rect x="760" y="1360" width="240" height="40" rx="4" fill="#bfdbfe" stroke="#0284c7" stroke-width="1"/>
  <text x="880" y="1380" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">Data tables, forms,</text>
  <text x="880" y="1395" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1e3a8a">all styled with county theme</text>
  
  <!-- Data Flow Legend -->
  <rect x="1050" y="1170" width="280" height="240" rx="8" fill="#f9fafb" stroke="#6b7280" stroke-width="2"/>
  <text x="1190" y="1195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#374151">Data Flow Legend</text>
  
  <path d="M 1070 1220 L 1100 1220" stroke="#1e3a8a" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1110" y="1225" font-family="Arial, sans-serif" font-size="11" fill="#374151">Authentication Flow</text>
  
  <path d="M 1070 1250 L 1100 1250" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1110" y="1255" font-family="Arial, sans-serif" font-size="11" fill="#374151">Theme Selection</text>
  
  <path d="M 1070 1280 L 1100 1280" stroke="#d97706" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1110" y="1285" font-family="Arial, sans-serif" font-size="11" fill="#374151">Routing Decision</text>
  
  <path d="M 1070 1310 L 1100 1310" stroke="#0284c7" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1110" y="1315" font-family="Arial, sans-serif" font-size="11" fill="#374151">API Request</text>
  
  <path d="M 1070 1340 L 1100 1340" stroke="#0284c7" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
  <text x="1110" y="1345" font-family="Arial, sans-serif" font-size="11" fill="#374151">API Response</text>
  
  <text x="1190" y="1375" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#374151">Key Points:</text>
  <text x="1070" y="1395" font-family="Arial, sans-serif" font-size="10" fill="#374151">1. Role determines dashboard route</text>
  <text x="1070" y="1410" font-family="Arial, sans-serif" font-size="10" fill="#374151">2. County determines theme colors</text>
  <text x="1070" y="1425" font-family="Arial, sans-serif" font-size="10" fill="#374151">3. Both applied simultaneously</text>
  <text x="1070" y="1440" font-family="Arial, sans-serif" font-size="10" fill="#374151">4. Admin always uses default theme</text>
  
  <!-- Summary Box -->
  <rect x="50" y="1480" width="1300" height="480" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="1505" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#d97706">
    Complete Data Flow Summary
  </text>
  
  <!-- Step 1 -->
  <rect x="100" y="1530" width="600" height="100" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="400" y="1555" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#92400e">Step 1: Login &amp; Token Generation</text>
  <text x="120" y="1575" font-family="Arial, sans-serif" font-size="11" fill="#78350f">User submits credentials → Keycloak authenticates → Returns JWT token containing:</text>
  <text x="120" y="1590" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• roles: ["ADMIN" | "SUPERVISOR" | "CASE_WORKER" | "PROVIDER" | "RECIPIENT"]</text>
  <text x="120" y="1605" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• groups: ["CTA" | "CTB" | "CTC"] (county groups from Keycloak)</text>
  <text x="120" y="1620" font-family="Arial, sans-serif" font-size="11" fill="#78350f">AuthContext decodes token, extracts role &amp; county, stores in React state &amp; localStorage</text>
  
  <!-- Step 2 -->
  <rect x="100" y="1650" width="600" height="100" rx="8" fill="#d1fae5" stroke="#059669" stroke-width="2"/>
  <text x="400" y="1675" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">Step 2: Theme Selection (County-Based)</text>
  <text x="120" y="1695" font-family="Arial, sans-serif" font-size="11" fill="#047857">CountyThemeContext reads user.county from AuthContext → Maps to CA.gov theme:</text>
  <text x="120" y="1710" font-family="Arial, sans-serif" font-size="11" fill="#047857">• CTA → Sacramento theme (Dark Blue #153554) → Loads /cagov/css/colortheme-sacramento.min.css</text>
  <text x="120" y="1725" font-family="Arial, sans-serif" font-size="11" fill="#047857">• CTB → Orange County theme (Orange #A15801) → Loads /cagov/css/colortheme-orangecounty.min.css</text>
  <text x="120" y="1740" font-family="Arial, sans-serif" font-size="11" fill="#047857">• CTC → Shasta theme (Green #336c39) → Loads /cagov/css/colortheme-shasta.min.css</text>
  <text x="120" y="1755" font-family="Arial, sans-serif" font-size="11" fill="#047857">CSS variables (--color-p2, etc.) applied globally → All components inherit county colors</text>
  
  <!-- Step 3 -->
  <rect x="100" y="1770" width="600" height="100" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="400" y="1795" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#92400e">Step 3: Role-Based Routing</text>
  <text x="120" y="1815" font-family="Arial, sans-serif" font-size="11" fill="#78350f">HomePage (app/page.tsx) reads user.role → Redirects to role-specific dashboard:</text>
  <text x="120" y="1830" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• ADMIN → /admin/keycloak (Keycloak management interface)</text>
  <text x="120" y="1845" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• SUPERVISOR → /supervisor/dashboard (Analytics, Batch Jobs, Field Masking)</text>
  <text x="120" y="1860" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• CASE_WORKER → /caseworker/dashboard (Work Queue, Tasks)</text>
  <text x="120" y="1875" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• PROVIDER → /provider/dashboard (Timesheets, Recipients)</text>
  <text x="120" y="1890" font-family="Arial, sans-serif" font-size="11" fill="#78350f">• RECIPIENT → /recipient/dashboard (Timesheets, Providers)</text>
  <text x="120" y="1905" font-family="Arial, sans-serif" font-size="11" fill="#78350f">Each dashboard component checks role on mount → Redirects to /login if unauthorized</text>
  
  <!-- Step 4 -->
  <rect x="720" y="1530" width="600" height="100" rx="8" fill="#f0f9ff" stroke="#0284c7" stroke-width="2"/>
  <text x="1020" y="1555" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e40af">Step 4: Data Fetching</text>
  <text x="740" y="1575" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">Dashboard component's useEffect hook triggers API calls via apiClient:</text>
  <text x="740" y="1590" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• GET /api/analytics → Returns analytics data (filtered by county if applicable)</text>
  <text x="740" y="1605" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• GET /api/batch-jobs → Returns batch job status (role-based access)</text>
  <text x="740" y="1620" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• GET /api/timesheets → Returns timesheets (filtered by user role &amp; county)</text>
  <text x="740" y="1635" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">API Client automatically adds JWT token to Authorization header → Backend validates token &amp; extracts role/county</text>
  
  <!-- Step 5 -->
  <rect x="720" y="1650" width="600" height="100" rx="8" fill="#f0f9ff" stroke="#0284c7" stroke-width="2"/>
  <text x="1020" y="1675" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e40af">Step 5: Backend Processing</text>
  <text x="740" y="1695" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">Spring Boot backend receives request → Validates JWT token → Extracts:</text>
  <text x="740" y="1710" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• User role from realm_access.roles → Determines which endpoints are accessible</text>
  <text x="740" y="1725" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• County from groups array → Applies county-based data filtering</text>
  <text x="740" y="1740" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• Queries PostgreSQL database with role &amp; county filters → Returns filtered JSON data</text>
  <text x="740" y="1755" font-family="Arial, sans-serif" font-size="11" fill="#1e3a8a">• Applies field-level masking based on user permissions → Sensitive data hidden if needed</text>
  
  <!-- Step 6 -->
  <rect x="720" y="1770" width="600" height="100" rx="8" fill="#d1fae5" stroke="#059669" stroke-width="2"/>
  <text x="1020" y="1795" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">Step 6: Rendering with County Theme</text>
  <text x="740" y="1815" font-family="Arial, sans-serif" font-size="11" fill="#047857">Frontend receives JSON response → Updates React state → Components re-render:</text>
  <text x="740" y="1830" font-family="Arial, sans-serif" font-size="11" fill="#047857">• Header: Uses var(--color-p2) for background (county-specific color)</text>
  <text x="740" y="1845" font-family="Arial, sans-serif" font-size="11" fill="#047857">• Buttons: Use var(--color-p2) for primary actions, var(--color-p2-darker) for hover</text>
  <text x="740" y="1860" font-family="Arial, sans-serif" font-size="11" fill="#047857">• Tables: Headers use county theme, rows styled with CA.gov template classes</text>
  <text x="740" y="1875" font-family="Arial, sans-serif" font-size="11" fill="#047857">• Forms: Inputs, labels, validation messages all use county theme colors</text>
  <text x="740" y="1890" font-family="Arial, sans-serif" font-size="11" fill="#047857">• All pages (not just dashboard) inherit the county theme → Consistent user experience</text>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1e3a8a" />
    </marker>
  </defs>
  
</svg>

