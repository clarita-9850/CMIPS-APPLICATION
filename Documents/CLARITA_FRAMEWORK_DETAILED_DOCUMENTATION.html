<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanra Solutions Enterprise Framework - Detailed Technical Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #7c3aed;
            --accent: #06b6d4;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --dark: #0f172a;
            --gray-900: #1e293b;
            --gray-800: #334155;
            --gray-700: #475569;
            --gray-600: #64748b;
            --gray-400: #94a3b8;
            --gray-200: #e2e8f0;
            --gray-100: #f1f5f9;
            --light: #f8fafc;
            --white: #ffffff;
        }

        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.7;
            color: var(--gray-800);
            background: var(--light);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-900) 50%, var(--primary) 100%);
            color: var(--white);
            padding: 60px 24px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 16px;
        }

        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        header .meta {
            margin-top: 24px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Table of Contents */
        .toc {
            background: var(--white);
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin: 32px 0;
        }

        .toc h2 {
            color: var(--dark);
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px 32px;
        }

        .toc a {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.95em;
            display: block;
            padding: 6px 0;
        }

        .toc a:hover {
            color: var(--secondary);
            text-decoration: underline;
        }

        /* Main Content */
        main {
            padding: 24px 0 48px 0;
        }

        section {
            background: var(--white);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        h2 {
            color: var(--dark);
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--primary);
        }

        h3 {
            color: var(--gray-900);
            font-size: 1.3em;
            font-weight: 600;
            margin: 32px 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--gray-200);
        }

        h4 {
            color: var(--gray-800);
            font-size: 1.1em;
            font-weight: 600;
            margin: 24px 0 12px 0;
        }

        h5 {
            color: var(--gray-700);
            font-size: 1em;
            font-weight: 600;
            margin: 20px 0 10px 0;
        }

        p {
            color: var(--gray-700);
            margin-bottom: 16px;
        }

        ul, ol {
            margin: 16px 0 16px 24px;
            color: var(--gray-700);
        }

        li {
            margin: 8px 0;
        }

        /* Info Boxes */
        .info-box {
            padding: 20px 24px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-box.concept {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid var(--primary);
        }

        .info-box.usecase {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left: 4px solid var(--success);
        }

        .info-box.important {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left: 4px solid var(--warning);
        }

        .info-box.example {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left: 4px solid var(--secondary);
        }

        .info-box strong {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-900);
            color: var(--white);
            font-weight: 600;
        }

        th:first-child { border-radius: 8px 0 0 0; }
        th:last-child { border-radius: 0 8px 0 0; }

        tr:hover { background: var(--gray-100); }

        /* Architecture Diagrams */
        .diagram {
            background: var(--dark);
            color: var(--gray-200);
            padding: 24px;
            border-radius: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.78em;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre;
            margin: 24px 0;
        }

        /* Flow Diagrams */
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .flow-step {
            background: var(--primary);
            color: var(--white);
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
            min-width: 120px;
        }

        .flow-arrow {
            color: var(--gray-400);
            font-size: 1.5em;
        }

        /* Feature Details */
        .feature-detail {
            background: var(--gray-100);
            border-radius: 10px;
            padding: 24px;
            margin: 20px 0;
        }

        .feature-detail h4 {
            color: var(--primary);
            margin-top: 0;
        }

        /* Two Column Layout */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        .col {
            background: var(--gray-100);
            padding: 20px;
            border-radius: 8px;
        }

        .col h4 {
            margin-top: 0;
            color: var(--primary);
        }

        /* Process Steps */
        .process-steps {
            counter-reset: step;
            margin: 24px 0;
        }

        .process-step {
            position: relative;
            padding-left: 48px;
            padding-bottom: 24px;
            border-left: 2px solid var(--gray-200);
            margin-left: 16px;
        }

        .process-step:last-child {
            border-left: none;
            padding-bottom: 0;
        }

        .process-step::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: -17px;
            top: 0;
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
        }

        .process-step h4 {
            margin-top: 0;
            margin-bottom: 8px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 24px;
            color: var(--gray-600);
            background: var(--white);
            margin-top: 48px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .toc-grid { grid-template-columns: 1fr; }
            .two-col { grid-template-columns: 1fr; }
            header h1 { font-size: 2em; }
            section { padding: 24px; }
        }

        @media print {
            section { box-shadow: none; border: 1px solid var(--gray-200); page-break-inside: avoid; }
            .diagram { font-size: 0.7em; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Sanra Solutions Enterprise Framework</h1>
            <p class="subtitle">Detailed Technical Documentation</p>
            <p class="meta">Comprehensive guide to framework features, architecture decisions, and implementation patterns | Version 2.0 | January 2026</p>
        </div>
    </header>

    <div class="container">
        <!-- Table of Contents -->
        <nav class="toc">
            <h2>Table of Contents</h2>
            <div class="toc-grid">
                <a href="#authentication">1. Authentication & Identity Management</a>
                <a href="#authorization">2. Authorization & Access Control</a>
                <a href="#entity-management">3. Entity Management System</a>
                <a href="#search-filtering">4. Search & Filtering</a>
                <a href="#audit-logging">5. Audit Logging</a>
                <a href="#document-management">6. Document Management</a>
                <a href="#notifications">7. Notification System</a>
                <a href="#event-system">8. Event-Driven Architecture</a>
                <a href="#batch-scheduler">9. Batch Job Scheduler</a>
                <a href="#integration-hub">10. Integration Hub Framework</a>
                <a href="#test-governance">11. Test Governance Framework</a>
                <a href="#api-gateway">12. API Gateway</a>
                <a href="#caching">13. Caching Strategy</a>
                <a href="#database">14. Database Design Patterns</a>
                <a href="#error-handling">15. Error Handling</a>
                <a href="#monitoring">16. Monitoring & Health Checks</a>
            </div>
        </nav>

        <!-- 1. Authentication -->
        <section id="authentication">
            <h2>1. Authentication & Identity Management</h2>

            <h3>Overview</h3>
            <p>The framework integrates with Keycloak, an open-source identity and access management solution, to handle all authentication concerns. This separation means the application doesn't store passwords or manage identity directly - it delegates to a dedicated, battle-tested identity provider.</p>

            <h3>How Authentication Works</h3>
            <div class="process-steps">
                <div class="process-step">
                    <h4>User Initiates Login</h4>
                    <p>User clicks "Login" in the application. The frontend redirects to Keycloak's login page (or embeds a login form that posts to Keycloak).</p>
                </div>
                <div class="process-step">
                    <h4>Keycloak Validates Credentials</h4>
                    <p>Keycloak verifies the username/password against its user database. If MFA is enabled, it prompts for the second factor.</p>
                </div>
                <div class="process-step">
                    <h4>Token Issuance</h4>
                    <p>Upon successful authentication, Keycloak issues a JWT (JSON Web Token) containing the user's identity and roles. This token is returned to the frontend.</p>
                </div>
                <div class="process-step">
                    <h4>API Requests with Token</h4>
                    <p>The frontend includes the JWT in the Authorization header for all API requests. The backend validates the token signature without needing to call Keycloak.</p>
                </div>
                <div class="process-step">
                    <h4>Token Refresh</h4>
                    <p>Before the token expires, the frontend uses a refresh token to obtain a new access token without requiring the user to log in again.</p>
                </div>
            </div>

            <h3>Supported Authentication Methods</h3>
            <table>
                <tr>
                    <th>Method</th>
                    <th>Description</th>
                    <th>When to Use</th>
                </tr>
                <tr>
                    <td><strong>Username/Password</strong></td>
                    <td>Traditional login with configurable password policies (length, complexity, expiry)</td>
                    <td>Default for most users, especially internal staff</td>
                </tr>
                <tr>
                    <td><strong>Single Sign-On (SSO)</strong></td>
                    <td>Federation with enterprise identity providers using SAML 2.0 or OpenID Connect</td>
                    <td>Organizations with existing Active Directory, Okta, Azure AD</td>
                </tr>
                <tr>
                    <td><strong>Multi-Factor Authentication</strong></td>
                    <td>Second factor via authenticator apps (TOTP), SMS codes, or email codes</td>
                    <td>High-security environments, compliance requirements</td>
                </tr>
                <tr>
                    <td><strong>Social Login</strong></td>
                    <td>Authentication via Google, Microsoft, Facebook accounts</td>
                    <td>Public-facing applications, citizen portals</td>
                </tr>
                <tr>
                    <td><strong>API Keys</strong></td>
                    <td>Static tokens for service-to-service authentication</td>
                    <td>External system integrations, batch processes</td>
                </tr>
            </table>

            <h3>Session Management</h3>
            <div class="feature-detail">
                <h4>Session Behavior</h4>
                <p>Sessions are managed through JWT tokens with configurable lifetimes:</p>
                <ul>
                    <li><strong>Access Token Lifetime</strong> - Typically 5-15 minutes. Short-lived for security.</li>
                    <li><strong>Refresh Token Lifetime</strong> - Typically 8-24 hours. Allows silent token renewal.</li>
                    <li><strong>Session Idle Timeout</strong> - Automatically log out after period of inactivity.</li>
                    <li><strong>Concurrent Session Limit</strong> - Optionally restrict users to one active session.</li>
                </ul>
            </div>

            <div class="info-box usecase">
                <strong>Use Case: Enterprise SSO Integration</strong>
                <p>A government agency wants employees to log in using their existing Active Directory credentials. Configure Keycloak to federate with their AD via LDAP or SAML. Users authenticate with their agency credentials, and Keycloak maps their AD groups to application roles automatically.</p>
            </div>
        </section>

        <!-- 2. Authorization -->
        <section id="authorization">
            <h2>2. Authorization & Access Control</h2>

            <h3>Overview</h3>
            <p>Authorization determines what an authenticated user can do. The framework implements multiple layers of access control to provide fine-grained permissions while keeping the model understandable.</p>

            <h3>Authorization Layers</h3>

            <h4>Layer 1: Role-Based Access Control (RBAC)</h4>
            <p>Users are assigned roles that grant broad categories of permissions. Roles are hierarchical - higher roles inherit permissions from lower roles.</p>

            <div class="diagram">
                                    ┌─────────────┐
                                    │    ADMIN    │
                                    │  (all access)│
                                    └──────┬──────┘
                                           │
                         ┌─────────────────┼─────────────────┐
                         ▼                 ▼                 ▼
                  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
                  │  SUPERVISOR │   │   MANAGER   │   │   ANALYST   │
                  │  (team data)│   │ (dept data) │   │  (reports)  │
                  └──────┬──────┘   └──────┬──────┘   └─────────────┘
                         │                 │
                         ▼                 ▼
                  ┌─────────────┐   ┌─────────────┐
                  │    STAFF    │   │    STAFF    │
                  │ (own data)  │   │ (own data)  │
                  └─────────────┘   └─────────────┘
            </div>

            <h4>Layer 2: Resource-Level Permissions</h4>
            <p>Beyond roles, the system checks if a user has access to a specific resource. This is based on ownership, assignment, or organizational hierarchy.</p>

            <div class="two-col">
                <div class="col">
                    <h4>Ownership-Based Access</h4>
                    <ul>
                        <li>User can only see records they created</li>
                        <li>Case worker sees only assigned cases</li>
                        <li>Manager sees team members' records</li>
                    </ul>
                </div>
                <div class="col">
                    <h4>Organization-Based Access</h4>
                    <ul>
                        <li>Users see data from their county/region only</li>
                        <li>Multi-tenant data isolation</li>
                        <li>Cross-organization access for admins</li>
                    </ul>
                </div>
            </div>

            <h4>Layer 3: Field-Level Authorization</h4>
            <p>Even when a user can access a record, certain fields may be hidden or masked based on their role.</p>

            <table>
                <tr>
                    <th>Field</th>
                    <th>Staff</th>
                    <th>Supervisor</th>
                    <th>Admin</th>
                </tr>
                <tr>
                    <td>Name, Email, Phone</td>
                    <td>Visible</td>
                    <td>Visible</td>
                    <td>Visible</td>
                </tr>
                <tr>
                    <td>Date of Birth</td>
                    <td>Visible</td>
                    <td>Visible</td>
                    <td>Visible</td>
                </tr>
                <tr>
                    <td>SSN</td>
                    <td>Masked (***-**-1234)</td>
                    <td>Masked</td>
                    <td>Visible</td>
                </tr>
                <tr>
                    <td>Salary Information</td>
                    <td>Hidden</td>
                    <td>Visible</td>
                    <td>Visible</td>
                </tr>
                <tr>
                    <td>Internal Notes</td>
                    <td>Hidden</td>
                    <td>Visible</td>
                    <td>Visible</td>
                </tr>
            </table>

            <div class="info-box concept">
                <strong>How Field-Level Authorization Works</strong>
                <p>When a record is retrieved, the service layer checks the current user's roles before returning data. Fields the user cannot see are either removed from the response entirely or replaced with masked values. This happens automatically - the controller doesn't need special logic.</p>
            </div>

            <h3>Permission Checking Flow</h3>
            <div class="flow-container">
                <div class="flow-step">Check Role</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Check Resource Access</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Filter Fields</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Return Data</div>
            </div>

            <div class="info-box usecase">
                <strong>Use Case: Multi-County Access Control</strong>
                <p>A state-level application serves multiple counties. Staff in County A should only see County A data. A state admin needs to see all counties. The framework automatically filters queries based on the user's organization assignment, and state admins are granted cross-organization access through a special role.</p>
            </div>
        </section>

        <!-- 3. Entity Management -->
        <section id="entity-management">
            <h2>3. Entity Management System</h2>

            <h3>Overview</h3>
            <p>Every data entity in the framework inherits from a base entity that provides common functionality: unique identifiers, audit timestamps, soft delete support, and optimistic locking. This consistency simplifies development and ensures all entities behave predictably.</p>

            <h3>Standard Entity Features</h3>

            <h4>Automatic Audit Fields</h4>
            <p>Every entity automatically tracks:</p>
            <ul>
                <li><strong>Created At</strong> - Timestamp when the record was first created</li>
                <li><strong>Created By</strong> - Username of the user who created it</li>
                <li><strong>Modified At</strong> - Timestamp of the last modification</li>
                <li><strong>Modified By</strong> - Username of the user who last modified it</li>
            </ul>
            <p>These fields are populated automatically by the framework - developers don't need to set them manually.</p>

            <h4>Soft Delete</h4>
            <p>Records are never physically deleted from the database. Instead, a "deleted_at" timestamp is set. This approach:</p>
            <ul>
                <li>Preserves data integrity and audit trails</li>
                <li>Allows recovery of accidentally deleted records</li>
                <li>Maintains referential integrity (foreign keys still work)</li>
                <li>Supports compliance requirements for data retention</li>
            </ul>
            <p>Queries automatically filter out soft-deleted records unless explicitly requested.</p>

            <h4>Optimistic Locking</h4>
            <p>Each entity has a version number that increments on every update. When saving, the framework checks if the version matches what was loaded. If another user modified the record in between, the save fails with a conflict error rather than silently overwriting their changes.</p>

            <div class="info-box example">
                <strong>Example: Concurrent Edit Detection</strong>
                <p>User A and User B both open the same case record (version 5). User A saves changes - the version becomes 6. When User B tries to save, the framework detects they're trying to update version 5, but the current version is 6. User B gets an error asking them to refresh and retry.</p>
            </div>

            <h3>Entity Lifecycle</h3>
            <div class="diagram">
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                        ENTITY LIFECYCLE                                  │
    ├─────────────────────────────────────────────────────────────────────────┤
    │                                                                          │
    │   ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐      │
    │   │  CREATE  │ ──▶ │  ACTIVE  │ ──▶ │  UPDATE  │ ──▶ │  ACTIVE  │      │
    │   └──────────┘     └──────────┘     └──────────┘     └──────────┘      │
    │        │                                  │                │            │
    │        │           Audit: created_at      │                │            │
    │        │                  created_by      │                │            │
    │        │                                  │                │            │
    │        │                            Audit: modified_at     │            │
    │        │                                  modified_by      │            │
    │        │                                  version++        │            │
    │        │                                                   │            │
    │        │                                                   ▼            │
    │        │                                            ┌──────────┐        │
    │        │                                            │  DELETE  │        │
    │        │                                            │ (soft)   │        │
    │        │                                            └──────────┘        │
    │        │                                                   │            │
    │        │                                            deleted_at = now    │
    │        │                                                   │            │
    │        │                                                   ▼            │
    │        │                                            ┌──────────┐        │
    │        └──────────────────────────────────────────▶ │ ARCHIVED │        │
    │                                                     │(recoverable)│      │
    │                                                     └──────────┘        │
    │                                                                          │
    └──────────────────────────────────────────────────────────────────────────┘
            </div>

            <h3>Standard CRUD Operations</h3>
            <p>Every entity supports consistent CRUD operations through standardized API endpoints:</p>
            <table>
                <tr>
                    <th>Operation</th>
                    <th>Endpoint Pattern</th>
                    <th>Behavior</th>
                </tr>
                <tr>
                    <td>List</td>
                    <td>GET /api/v1/{entity}</td>
                    <td>Returns paginated list with filtering and sorting</td>
                </tr>
                <tr>
                    <td>Get One</td>
                    <td>GET /api/v1/{entity}/{id}</td>
                    <td>Returns single record by ID (404 if not found or deleted)</td>
                </tr>
                <tr>
                    <td>Create</td>
                    <td>POST /api/v1/{entity}</td>
                    <td>Creates new record, returns created entity with ID</td>
                </tr>
                <tr>
                    <td>Update</td>
                    <td>PUT /api/v1/{entity}/{id}</td>
                    <td>Full update, requires all fields, version checked</td>
                </tr>
                <tr>
                    <td>Partial Update</td>
                    <td>PATCH /api/v1/{entity}/{id}</td>
                    <td>Partial update, only provided fields change</td>
                </tr>
                <tr>
                    <td>Delete</td>
                    <td>DELETE /api/v1/{entity}/{id}</td>
                    <td>Soft delete - sets deleted_at, record remains in DB</td>
                </tr>
            </table>
        </section>

        <!-- 4. Search & Filtering -->
        <section id="search-filtering">
            <h2>4. Search & Filtering</h2>

            <h3>Overview</h3>
            <p>The framework provides a powerful, consistent approach to searching and filtering data across all entities. List endpoints automatically support pagination, sorting, full-text search, and field-based filtering without requiring custom code for each entity.</p>

            <h3>Pagination</h3>
            <p>All list endpoints return paginated results to handle large datasets efficiently:</p>
            <ul>
                <li><strong>Page Number</strong> - Zero-indexed page number (default: 0)</li>
                <li><strong>Page Size</strong> - Number of records per page (default: 20, max: 100)</li>
                <li><strong>Total Count</strong> - Total number of matching records</li>
                <li><strong>Total Pages</strong> - Total number of pages available</li>
            </ul>

            <h3>Sorting</h3>
            <p>Results can be sorted by any field in ascending or descending order:</p>
            <ul>
                <li>Single field: <code>sort=createdAt,desc</code></li>
                <li>Multiple fields: <code>sort=status,asc&sort=createdAt,desc</code></li>
                <li>Default sort is by creation date, newest first</li>
            </ul>

            <h3>Full-Text Search</h3>
            <p>The <code>search</code> parameter performs a full-text search across designated searchable fields. For a person entity, searching "John Smith" would match records where:</p>
            <ul>
                <li>First name contains "John" or "Smith"</li>
                <li>Last name contains "John" or "Smith"</li>
                <li>Email contains "John" or "Smith"</li>
            </ul>

            <h3>Field Filtering</h3>
            <p>Filter by specific field values using query parameters:</p>
            <table>
                <tr>
                    <th>Filter Type</th>
                    <th>Example</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>Exact Match</td>
                    <td>status=ACTIVE</td>
                    <td>Records where status equals ACTIVE</td>
                </tr>
                <tr>
                    <td>Multiple Values</td>
                    <td>status=ACTIVE,PENDING</td>
                    <td>Records where status is ACTIVE or PENDING</td>
                </tr>
                <tr>
                    <td>Date Range</td>
                    <td>createdAfter=2024-01-01&createdBefore=2024-12-31</td>
                    <td>Records created within date range</td>
                </tr>
                <tr>
                    <td>Relationship</td>
                    <td>organizationId=uuid</td>
                    <td>Records belonging to specific organization</td>
                </tr>
                <tr>
                    <td>Boolean</td>
                    <td>isVerified=true</td>
                    <td>Records where isVerified is true</td>
                </tr>
            </table>

            <div class="info-box usecase">
                <strong>Use Case: Complex Search Query</strong>
                <p>Find all active cases in Los Angeles County, assigned to the current user, created in the last 30 days, sorted by priority:</p>
                <p><code>GET /api/v1/cases?status=ACTIVE&county=LA&assignedTo=me&createdAfter=2024-01-01&sort=priority,desc</code></p>
            </div>
        </section>

        <!-- 5. Audit Logging -->
        <section id="audit-logging">
            <h2>5. Audit Logging</h2>

            <h3>Overview</h3>
            <p>The framework automatically records a complete history of all data changes. Every create, update, and delete operation is logged with details about who made the change, when, and what exactly changed.</p>

            <h3>What Gets Logged</h3>
            <table>
                <tr>
                    <th>Information</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><strong>Entity Type</strong></td>
                    <td>The type of record (Person, Case, Document, etc.)</td>
                </tr>
                <tr>
                    <td><strong>Entity ID</strong></td>
                    <td>The unique identifier of the affected record</td>
                </tr>
                <tr>
                    <td><strong>Action</strong></td>
                    <td>CREATE, UPDATE, or DELETE</td>
                </tr>
                <tr>
                    <td><strong>Previous State</strong></td>
                    <td>JSON snapshot of the record before the change (for updates/deletes)</td>
                </tr>
                <tr>
                    <td><strong>New State</strong></td>
                    <td>JSON snapshot of the record after the change (for creates/updates)</td>
                </tr>
                <tr>
                    <td><strong>Changed Fields</strong></td>
                    <td>List of specific fields that were modified</td>
                </tr>
                <tr>
                    <td><strong>User</strong></td>
                    <td>Username of the person who made the change</td>
                </tr>
                <tr>
                    <td><strong>Timestamp</strong></td>
                    <td>Exact date and time of the change</td>
                </tr>
                <tr>
                    <td><strong>IP Address</strong></td>
                    <td>Source IP address of the request</td>
                </tr>
            </table>

            <h3>Use Cases for Audit Logs</h3>

            <h4>Compliance & Regulatory</h4>
            <p>Many regulations (HIPAA, SOC 2, etc.) require tracking who accessed or modified sensitive data. Audit logs provide the evidence needed for compliance audits.</p>

            <h4>Debugging & Support</h4>
            <p>When users report that "something changed" or "data is wrong," audit logs show exactly what happened, when, and who did it. This speeds up troubleshooting significantly.</p>

            <h4>Undo / Recovery</h4>
            <p>Since previous states are captured, it's possible to restore data to a prior state if changes need to be reverted.</p>

            <h4>Analytics</h4>
            <p>Audit logs can be analyzed to understand user behavior patterns, identify heavy editors, or detect unusual activity that might indicate a security issue.</p>

            <div class="info-box important">
                <strong>Audit Log Retention</strong>
                <p>Audit logs are stored separately from operational data and have their own retention policy. By default, logs are retained indefinitely, but this can be configured based on compliance requirements and storage considerations.</p>
            </div>
        </section>

        <!-- 6. Document Management -->
        <section id="document-management">
            <h2>6. Document Management</h2>

            <h3>Overview</h3>
            <p>The framework provides a complete document management system for handling file uploads, storage, versioning, and retrieval. It abstracts the storage backend so the same API works whether files are stored locally, on AWS S3, or Azure Blob Storage.</p>

            <h3>Document Features</h3>

            <h4>File Upload</h4>
            <ul>
                <li>Support for any file type with configurable restrictions</li>
                <li>Maximum file size limits (configurable)</li>
                <li>Automatic MIME type detection and validation</li>
                <li>Virus scanning integration hook (optional)</li>
                <li>Progress tracking for large uploads</li>
            </ul>

            <h4>Metadata Tracking</h4>
            <p>Each document stores metadata including:</p>
            <ul>
                <li>Original filename</li>
                <li>File size</li>
                <li>MIME type</li>
                <li>Upload timestamp and user</li>
                <li>Custom metadata (key-value pairs)</li>
                <li>Associated entity (e.g., which case this document belongs to)</li>
            </ul>

            <h4>Versioning</h4>
            <p>When a document is updated (same name uploaded again), the previous version is preserved. Users can:</p>
            <ul>
                <li>View version history</li>
                <li>Download any previous version</li>
                <li>Compare versions</li>
                <li>Restore a previous version</li>
            </ul>

            <h4>Storage Backends</h4>
            <table>
                <tr>
                    <th>Backend</th>
                    <th>When to Use</th>
                    <th>Configuration</th>
                </tr>
                <tr>
                    <td><strong>Local Filesystem</strong></td>
                    <td>Development, small deployments</td>
                    <td>Specify base directory path</td>
                </tr>
                <tr>
                    <td><strong>AWS S3</strong></td>
                    <td>Production on AWS, scalable storage</td>
                    <td>Bucket name, region, credentials</td>
                </tr>
                <tr>
                    <td><strong>Azure Blob Storage</strong></td>
                    <td>Production on Azure</td>
                    <td>Container name, connection string</td>
                </tr>
            </table>

            <div class="info-box usecase">
                <strong>Use Case: Case File Attachments</strong>
                <p>A case management system needs to attach supporting documents to cases. Staff upload documents through the UI, the framework stores them in S3, tracks metadata, and associates them with the case. When the case is viewed, the document list is retrieved and users can download or preview attachments.</p>
            </div>
        </section>

        <!-- 7. Notifications -->
        <section id="notifications">
            <h2>7. Notification System</h2>

            <h3>Overview</h3>
            <p>The notification system provides a unified way to send messages to users through multiple channels: email, SMS, in-app notifications, and push notifications. It uses templates for consistent messaging and supports scheduling for delayed delivery.</p>

            <h3>Notification Channels</h3>

            <h4>Email</h4>
            <p>HTML and plain text emails with support for attachments, CC/BCC, and reply-to addresses. Integrates with SMTP servers or email services like SendGrid, AWS SES.</p>

            <h4>SMS</h4>
            <p>Text messages via Twilio, AWS SNS, or other SMS providers. Includes delivery status tracking.</p>

            <h4>In-App Notifications</h4>
            <p>Notifications displayed within the application UI. Users see a notification indicator and can view their notification history.</p>

            <h4>Push Notifications</h4>
            <p>Browser push notifications for immediate alerts even when the app isn't open (requires user opt-in).</p>

            <h3>Template System</h3>
            <p>Notifications use templates with variable substitution:</p>
            <ul>
                <li>Templates stored in database, editable without code changes</li>
                <li>Variables like {recipientName}, {caseNumber}, {dueDate}</li>
                <li>Different templates for each channel (email vs SMS)</li>
                <li>Localization support for multiple languages</li>
            </ul>

            <div class="info-box example">
                <strong>Example: Case Assignment Notification</strong>
                <p><strong>Template:</strong> "Hello {recipientName}, case #{caseNumber} has been assigned to you. The due date is {dueDate}. Please review at your earliest convenience."</p>
                <p><strong>Result:</strong> "Hello John Smith, case #2024-00123 has been assigned to you. The due date is January 30, 2024. Please review at your earliest convenience."</p>
            </div>

            <h3>Notification Preferences</h3>
            <p>Users can configure their notification preferences:</p>
            <ul>
                <li>Which channels to receive notifications on</li>
                <li>Which notification types to receive</li>
                <li>Quiet hours (no notifications during certain times)</li>
                <li>Digest mode (batch notifications into a daily summary)</li>
            </ul>
        </section>

        <!-- 8. Event System -->
        <section id="event-system">
            <h2>8. Event-Driven Architecture</h2>

            <h3>Overview</h3>
            <p>The framework uses Apache Kafka for event-driven communication between components. When something significant happens in the system, an event is published. Other components can subscribe to these events and react accordingly, without tight coupling between services.</p>

            <h3>How Events Work</h3>
            <div class="diagram">
    ┌─────────────────────────────────────────────────────────────────────────────────────┐
    │                              EVENT FLOW                                              │
    ├─────────────────────────────────────────────────────────────────────────────────────┤
    │                                                                                      │
    │   ┌──────────────────┐                                                              │
    │   │  Backend Service │                                                              │
    │   │                  │                                                              │
    │   │  Case Updated    │──────▶ PUBLISH ──────▶ ┌──────────────────────────────────┐ │
    │   │                  │                        │          APACHE KAFKA             │ │
    │   └──────────────────┘                        │                                   │ │
    │                                               │  Topic: case-events               │ │
    │                                               │                                   │ │
    │                                               │  Event: {                         │ │
    │                                               │    type: "CASE_UPDATED",          │ │
    │                                               │    caseId: "abc-123",             │ │
    │                                               │    changedFields: ["status"],     │ │
    │                                               │    previousStatus: "PENDING",     │ │
    │                                               │    newStatus: "APPROVED",         │ │
    │                                               │    timestamp: "2024-01-20T..."    │ │
    │                                               │  }                                │ │
    │                                               │                                   │ │
    │                                               └───────────────┬──────────────────┘ │
    │                                                               │                     │
    │                              ┌────────────────────────────────┼───────────────┐    │
    │                              │                                │               │    │
    │                              ▼                                ▼               ▼    │
    │                    ┌──────────────────┐             ┌──────────────┐  ┌──────────┐│
    │                    │Notification Svc  │             │ Search Index │  │ Audit    ││
    │                    │                  │             │              │  │ Logger   ││
    │                    │ Send approval    │             │ Update case  │  │          ││
    │                    │ email to user    │             │ in search    │  │ Log      ││
    │                    │                  │             │ index        │  │ change   ││
    │                    └──────────────────┘             └──────────────┘  └──────────┘│
    │                                                                                      │
    └──────────────────────────────────────────────────────────────────────────────────────┘
            </div>

            <h3>Benefits of Event-Driven Design</h3>

            <h4>Loose Coupling</h4>
            <p>The backend service doesn't need to know about notification service, search indexing, or audit logging. It just publishes events. New subscribers can be added without modifying the publisher.</p>

            <h4>Reliability</h4>
            <p>Kafka persists events to disk. If a subscriber is temporarily down, events are retained and processed when it recovers. No data is lost.</p>

            <h4>Scalability</h4>
            <p>Multiple instances of a subscriber can process events in parallel. Kafka partitioning ensures each event is processed by exactly one instance.</p>

            <h4>Debugging & Replay</h4>
            <p>Events can be replayed for debugging or to rebuild state. If the search index gets corrupted, replay all events to rebuild it.</p>

            <h3>Common Event Types</h3>
            <table>
                <tr>
                    <th>Event Category</th>
                    <th>Examples</th>
                    <th>Common Subscribers</th>
                </tr>
                <tr>
                    <td><strong>Entity Events</strong></td>
                    <td>Created, Updated, Deleted</td>
                    <td>Audit logger, Search indexer, Notifications</td>
                </tr>
                <tr>
                    <td><strong>Status Changes</strong></td>
                    <td>Case approved, Payment processed</td>
                    <td>Notifications, Workflow engine, Reporting</td>
                </tr>
                <tr>
                    <td><strong>User Events</strong></td>
                    <td>Login, Logout, Password changed</td>
                    <td>Audit logger, Security monitoring</td>
                </tr>
                <tr>
                    <td><strong>System Events</strong></td>
                    <td>Job completed, Error occurred</td>
                    <td>Monitoring, Alerting</td>
                </tr>
            </table>
        </section>

        <!-- 9. Batch Scheduler -->
        <section id="batch-scheduler">
            <h2>9. Batch Job Scheduler</h2>

            <h3>Overview</h3>
            <p>The batch scheduler is a dedicated service for running automated jobs. It combines Quartz Scheduler for job triggering with Spring Batch for reliable batch processing. Jobs can be scheduled using cron expressions, configured with dependencies, and monitored in real-time.</p>

            <h3>Key Concepts</h3>

            <h4>Job Definition</h4>
            <p>A job definition describes what should run and when:</p>
            <ul>
                <li><strong>Job Name</strong> - Unique identifier for the job</li>
                <li><strong>Job Class</strong> - The implementation that executes the job</li>
                <li><strong>Schedule</strong> - Cron expression or interval (e.g., "0 0 2 * * ?" for 2 AM daily)</li>
                <li><strong>Parameters</strong> - Configuration values passed to the job</li>
                <li><strong>Enabled Flag</strong> - Toggle job on/off without deleting it</li>
            </ul>

            <h4>Job Dependencies</h4>
            <p>Jobs can depend on other jobs. A dependent job won't start until its prerequisites complete:</p>
            <ul>
                <li><strong>SUCCESS</strong> - Run only if parent succeeded</li>
                <li><strong>COMPLETION</strong> - Run when parent completes (success or failure)</li>
                <li><strong>FAILURE</strong> - Run only if parent failed (for cleanup or alerts)</li>
            </ul>

            <div class="diagram">
    ┌─────────────────────────────────────────────────────────────────────────────────────┐
    │                         JOB DEPENDENCY EXAMPLE                                       │
    ├─────────────────────────────────────────────────────────────────────────────────────┤
    │                                                                                      │
    │                              ┌─────────────────┐                                    │
    │                              │  EXTRACT DATA   │                                    │
    │                              │   (Job A)       │                                    │
    │                              │  2:00 AM        │                                    │
    │                              └────────┬────────┘                                    │
    │                                       │                                             │
    │                                       │ SUCCESS                                     │
    │                                       ▼                                             │
    │                              ┌─────────────────┐                                    │
    │                              │ TRANSFORM DATA  │                                    │
    │                              │   (Job B)       │                                    │
    │                              │  After Job A    │                                    │
    │                              └────────┬────────┘                                    │
    │                                       │                                             │
    │                         ┌─────────────┴─────────────┐                              │
    │                         │ SUCCESS                   │ FAILURE                       │
    │                         ▼                           ▼                               │
    │                ┌─────────────────┐         ┌─────────────────┐                     │
    │                │  LOAD TO DW     │         │ SEND ALERT      │                     │
    │                │   (Job C)       │         │   (Job D)       │                     │
    │                └─────────────────┘         └─────────────────┘                     │
    │                                                                                      │
    └──────────────────────────────────────────────────────────────────────────────────────┘
            </div>

            <h4>Business Calendars</h4>
            <p>Jobs can be configured to skip execution on certain days:</p>
            <ul>
                <li>Federal holidays</li>
                <li>State holidays</li>
                <li>Weekends</li>
                <li>Custom blackout dates</li>
            </ul>

            <h4>Retry Policies</h4>
            <p>When a job fails, it can automatically retry:</p>
            <ul>
                <li><strong>Max Retries</strong> - Number of retry attempts (default: 3)</li>
                <li><strong>Retry Delay</strong> - Time between retries (default: 5 minutes)</li>
                <li><strong>Exponential Backoff</strong> - Optional increasing delay between retries</li>
            </ul>

            <h3>Batch Processing Features</h3>

            <h4>Chunk-Based Processing</h4>
            <p>Large datasets are processed in chunks (e.g., 1000 records at a time). This:</p>
            <ul>
                <li>Reduces memory usage</li>
                <li>Allows partial progress on failure</li>
                <li>Enables parallel processing of chunks</li>
            </ul>

            <h4>Checkpoint & Restart</h4>
            <p>The framework tracks progress through the data. If a job fails at record 5000 of 10000, it can restart from record 5000 instead of starting over.</p>

            <h4>Skip & Retry</h4>
            <p>Individual records that fail can be skipped (logged for manual review) while processing continues. Transient errors (like database timeouts) trigger automatic retry.</p>

            <h3>Common Job Types</h3>
            <table>
                <tr>
                    <th>Job Type</th>
                    <th>Description</th>
                    <th>Example Use Cases</th>
                </tr>
                <tr>
                    <td><strong>Data Export</strong></td>
                    <td>Extract data and write to files or external systems</td>
                    <td>Generate transaction files, create scheduled reports</td>
                </tr>
                <tr>
                    <td><strong>Data Import</strong></td>
                    <td>Read external data and load into the system</td>
                    <td>Import partner files, load reference data</td>
                </tr>
                <tr>
                    <td><strong>Data Sync</strong></td>
                    <td>Synchronize data between systems</td>
                    <td>Sync with external systems, update from partner sources</td>
                </tr>
                <tr>
                    <td><strong>Notifications</strong></td>
                    <td>Send batch notifications</td>
                    <td>Monthly statements, reminder emails, expiration notices</td>
                </tr>
                <tr>
                    <td><strong>Maintenance</strong></td>
                    <td>System maintenance tasks</td>
                    <td>Archive old records, cleanup temp files, update statistics</td>
                </tr>
                <tr>
                    <td><strong>Calculations</strong></td>
                    <td>Complex calculations on large datasets</td>
                    <td>Payment calculations, eligibility determinations</td>
                </tr>
            </table>
        </section>

        <!-- 10. Integration Hub Framework -->
        <section id="integration-hub">
            <h2>10. Integration Hub Framework</h2>

            <h3>Overview</h3>
            <p>The Integration Hub Framework provides a centralized, managed approach to all external system communications. Instead of building direct point-to-point integrations scattered throughout the codebase, all external connections flow through the Integration Hub, which standardizes connection management, error handling, monitoring, and security.</p>

            <h3>Architecture Concepts</h3>

            <h4>Connectors</h4>
            <p>Connectors are reusable components that handle communication with external systems. Each connector type encapsulates the protocol-specific details:</p>
            <ul>
                <li><strong>REST Connector</strong> - For HTTP/HTTPS REST API integrations with support for various authentication methods</li>
                <li><strong>SOAP Connector</strong> - For legacy SOAP/XML web services with WSDL support</li>
                <li><strong>SFTP Connector</strong> - For secure file transfers with support for key-based and password authentication</li>
                <li><strong>Database Connector</strong> - For direct database integrations (read-only recommended)</li>
                <li><strong>Message Queue Connector</strong> - For JMS, RabbitMQ, or other message broker integrations</li>
            </ul>

            <h4>Integration Endpoints</h4>
            <p>Each external system is configured as an endpoint with its connection details, credentials, and behavior settings:</p>
            <table>
                <tr>
                    <th>Configuration</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><strong>Base URL / Host</strong></td>
                    <td>The external system's address</td>
                    <td>https://api.partner.gov/v2</td>
                </tr>
                <tr>
                    <td><strong>Authentication</strong></td>
                    <td>How to authenticate with the system</td>
                    <td>OAuth2 Client Credentials, API Key, mTLS</td>
                </tr>
                <tr>
                    <td><strong>Timeout Settings</strong></td>
                    <td>Connection and read timeouts</td>
                    <td>Connect: 10s, Read: 30s</td>
                </tr>
                <tr>
                    <td><strong>Retry Policy</strong></td>
                    <td>How to handle transient failures</td>
                    <td>3 retries with exponential backoff</td>
                </tr>
                <tr>
                    <td><strong>Circuit Breaker</strong></td>
                    <td>When to stop calling a failing system</td>
                    <td>Open after 5 failures in 60 seconds</td>
                </tr>
            </table>

            <h3>Integration Patterns</h3>

            <h4>Synchronous Request-Response</h4>
            <p>For real-time data retrieval or verification where the calling service needs an immediate response:</p>
            <div class="process-steps">
                <div class="process-step">
                    <h4>Application Makes Request</h4>
                    <p>Business logic calls the Integration Hub service with the request data and target endpoint identifier.</p>
                </div>
                <div class="process-step">
                    <h4>Hub Prepares Request</h4>
                    <p>Loads endpoint configuration, applies transformations, adds authentication headers.</p>
                </div>
                <div class="process-step">
                    <h4>External Call</h4>
                    <p>Executes the request with configured timeout and retry policies. Logs all details.</p>
                </div>
                <div class="process-step">
                    <h4>Response Processing</h4>
                    <p>Transforms response to internal format, validates structure, handles errors.</p>
                </div>
                <div class="process-step">
                    <h4>Return to Caller</h4>
                    <p>Returns standardized response object with data, status, and any warnings.</p>
                </div>
            </div>

            <h4>Asynchronous Messaging</h4>
            <p>For operations that don't require immediate response or involve large data volumes:</p>
            <ul>
                <li><strong>Fire-and-Forget</strong> - Send a message and continue without waiting for confirmation</li>
                <li><strong>Guaranteed Delivery</strong> - Message is queued and retried until acknowledged</li>
                <li><strong>Request-Callback</strong> - Send request now, receive response via webhook later</li>
            </ul>

            <h4>Batch File Exchange</h4>
            <p>For scheduled bulk data transfers, typically with government systems:</p>
            <ul>
                <li><strong>File Generation</strong> - Generate files in required format (fixed-width, CSV, XML)</li>
                <li><strong>Secure Transfer</strong> - Upload via SFTP with encryption and integrity checks</li>
                <li><strong>Acknowledgment Processing</strong> - Download and process response files</li>
                <li><strong>Error Reconciliation</strong> - Match errors back to source records</li>
            </ul>

            <h3>Error Handling & Resilience</h3>

            <h4>Circuit Breaker Pattern</h4>
            <p>When an external system becomes unavailable, the Integration Hub prevents cascading failures:</p>
            <div class="diagram">
    ┌─────────────────────────────────────────────────────────────────────────────────────┐
    │                          CIRCUIT BREAKER STATES                                      │
    ├─────────────────────────────────────────────────────────────────────────────────────┤
    │                                                                                      │
    │     ┌──────────────┐                                                                │
    │     │    CLOSED    │  ◄─────────────────────────────────────────┐                   │
    │     │  (Normal)    │                                            │                   │
    │     └──────┬───────┘                                            │                   │
    │            │                                                    │                   │
    │            │ Failure threshold                                  │ Success           │
    │            │ exceeded (5 failures                               │ threshold         │
    │            │ in 60 seconds)                                     │ reached           │
    │            ▼                                                    │                   │
    │     ┌──────────────┐         Timeout          ┌──────────────┐ │                   │
    │     │     OPEN     │ ─────────────────────▶   │  HALF-OPEN   │─┘                   │
    │     │  (Failing)   │        (60 sec)          │   (Testing)  │                     │
    │     │              │ ◄─────────────────────── │              │                     │
    │     └──────────────┘     Test request         └──────────────┘                     │
    │                          fails                                                      │
    │                                                                                      │
    │   CLOSED: All requests flow through normally                                        │
    │   OPEN: Requests fail immediately without calling external system                   │
    │   HALF-OPEN: Limited requests allowed to test if system recovered                   │
    │                                                                                      │
    └──────────────────────────────────────────────────────────────────────────────────────┘
            </div>

            <h4>Dead Letter Queue</h4>
            <p>Messages that fail repeatedly after all retry attempts are moved to a dead letter queue for manual investigation. Operators can:</p>
            <ul>
                <li>View failed message details and error history</li>
                <li>Manually retry after fixing the issue</li>
                <li>Move to a different queue for reprocessing</li>
                <li>Archive with explanation if unrecoverable</li>
            </ul>

            <h3>Monitoring & Observability</h3>

            <h4>Transaction Tracking</h4>
            <p>Every integration transaction is assigned a correlation ID that flows through all systems. This enables end-to-end tracing from the initiating request through all external calls.</p>

            <h4>Metrics & Dashboards</h4>
            <table>
                <tr>
                    <th>Metric</th>
                    <th>Description</th>
                    <th>Alert Condition</th>
                </tr>
                <tr>
                    <td><strong>Request Volume</strong></td>
                    <td>Number of requests per endpoint per time period</td>
                    <td>Unusual spike or drop</td>
                </tr>
                <tr>
                    <td><strong>Response Time</strong></td>
                    <td>P50, P95, P99 latency percentiles</td>
                    <td>P95 exceeds threshold</td>
                </tr>
                <tr>
                    <td><strong>Error Rate</strong></td>
                    <td>Percentage of requests that fail</td>
                    <td>Error rate > 5%</td>
                </tr>
                <tr>
                    <td><strong>Circuit Status</strong></td>
                    <td>Current state of circuit breaker</td>
                    <td>Circuit opens</td>
                </tr>
                <tr>
                    <td><strong>Queue Depth</strong></td>
                    <td>Messages waiting to be processed</td>
                    <td>Queue growing unbounded</td>
                </tr>
            </table>

            <div class="info-box usecase">
                <strong>Use Case: State Eligibility Verification</strong>
                <p>An application needs to verify client eligibility with a state Medicaid system. The Integration Hub is configured with the state's API endpoint, OAuth credentials, and a 3-retry policy. When verification is requested, the Hub handles authentication token refresh, retries on timeout, and returns standardized results. If the state system goes down, the circuit breaker prevents timeouts from affecting application performance.</p>
            </div>
        </section>

        <!-- 11. Test Governance Framework -->
        <section id="test-governance">
            <h2>11. Test Governance Framework (Library)</h2>

            <h3>Overview</h3>
            <p>The Test Governance Framework is a <strong>build-time Java library</strong> that enforces test coverage for critical business rules. It uses source code annotations to link business rules in production code with their corresponding tests, then validates coverage during the build process.</p>

            <div class="info-box highlight">
                <strong>Important: This is a Library, Not a Service</strong>
                <p style="margin-top: 8px; margin-bottom: 0;">Test Governance is NOT a runtime service or test management UI. It's a build-time validation tool that scans your codebase for @BusinessRule and @TestsRule annotations, validates coverage, and generates compliance reports. The annotations have zero runtime overhead.</p>
            </div>

            <h3>How It Works</h3>

            <div class="diagram">
    ┌─────────────────────────────────────────────────────────────────────────────────────┐
    │                        TEST GOVERNANCE VALIDATION FLOW                               │
    ├─────────────────────────────────────────────────────────────────────────────────────┤
    │                                                                                      │
    │   PRODUCTION CODE                          TEST CODE                                │
    │   ──────────────────                       ─────────────                            │
    │                                                                                      │
    │   @BusinessRule(                           @Test                                    │
    │     ruleId="BR-PAY-001",                   @TestsRule(                              │
    │     severity=CRITICAL,                       ruleId="BR-PAY-001",                   │
    │     owner="payments-team"                    scenarios={"valid","invalid"}          │
    │   )                                        )                                        │
    │   public void calculatePayment() {         void testPaymentCalculation() {         │
    │     // business logic                        // test logic                          │
    │   }                                        }                                        │
    │                                                                                      │
    │         │                                          │                                │
    │         └──────────────────┬───────────────────────┘                                │
    │                            │                                                         │
    │                            ▼                                                         │
    │              ┌──────────────────────────────┐                                       │
    │              │   GOVERNANCE VALIDATOR       │                                       │
    │              │   (Runs at Build Time)       │                                       │
    │              │                              │                                       │
    │              │   • Scans for @BusinessRule  │                                       │
    │              │   • Scans for @TestsRule     │                                       │
    │              │   • Matches by ruleId        │                                       │
    │              │   • Checks coverage          │                                       │
    │              └──────────────┬───────────────┘                                       │
    │                             │                                                        │
    │              ┌──────────────┴───────────────┐                                       │
    │              │                              │                                        │
    │              ▼                              ▼                                        │
    │   ┌─────────────────────┐      ┌─────────────────────┐                             │
    │   │   BUILD PASSES      │      │   BUILD FAILS       │                             │
    │   │   (All rules have   │      │   (Critical rules   │                             │
    │   │    test coverage)   │      │    lack tests)      │                             │
    │   └─────────────────────┘      └─────────────────────┘                             │
    │                                                                                      │
    └──────────────────────────────────────────────────────────────────────────────────────┘
            </div>

            <h3>@BusinessRule Annotation</h3>
            <p>Add this annotation to critical methods in your production code:</p>
            <table>
                <tr>
                    <th>Attribute</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><strong>ruleId</strong></td>
                    <td>Unique identifier for the business rule</td>
                    <td>"BR-PAY-001", "BR-AUTH-015"</td>
                </tr>
                <tr>
                    <td><strong>description</strong></td>
                    <td>Human-readable description of the rule</td>
                    <td>"Calculate overtime pay based on hours worked"</td>
                </tr>
                <tr>
                    <td><strong>severity</strong></td>
                    <td>Importance level (affects build behavior)</td>
                    <td>CRITICAL, HIGH, MEDIUM, LOW</td>
                </tr>
                <tr>
                    <td><strong>owner</strong></td>
                    <td>Team or person responsible</td>
                    <td>"payments-team", "john.doe"</td>
                </tr>
                <tr>
                    <td><strong>compliance</strong></td>
                    <td>Applicable compliance frameworks</td>
                    <td>CMS_SMC, HIPAA, FISMA, NIST_800_53</td>
                </tr>
                <tr>
                    <td><strong>categories</strong></td>
                    <td>Test categories required</td>
                    <td>UNIT, INTEGRATION, COMPLIANCE</td>
                </tr>
            </table>

            <h3>@TestsRule Annotation</h3>
            <p>Add this annotation to test methods that verify business rules:</p>
            <table>
                <tr>
                    <th>Attribute</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><strong>ruleId</strong></td>
                    <td>References the @BusinessRule being tested</td>
                    <td>"BR-PAY-001"</td>
                </tr>
                <tr>
                    <td><strong>scenarios</strong></td>
                    <td>Specific scenarios covered by this test</td>
                    <td>{"valid_input", "boundary_case", "error_handling"}</td>
                </tr>
                <tr>
                    <td><strong>author</strong></td>
                    <td>Who wrote this test</td>
                    <td>"jane.smith"</td>
                </tr>
                <tr>
                    <td><strong>category</strong></td>
                    <td>Type of test</td>
                    <td>UNIT, INTEGRATION, COMPLIANCE</td>
                </tr>
            </table>

            <h3>Severity Levels</h3>
            <table>
                <tr>
                    <th>Severity</th>
                    <th>Build Behavior</th>
                    <th>Use For</th>
                </tr>
                <tr>
                    <td><strong>CRITICAL</strong></td>
                    <td>Fails build immediately if no test coverage</td>
                    <td>Financial calculations, security logic, compliance-critical rules</td>
                </tr>
                <tr>
                    <td><strong>HIGH</strong></td>
                    <td>Fails on PR merge</td>
                    <td>Core business logic, data integrity rules</td>
                </tr>
                <tr>
                    <td><strong>MEDIUM</strong></td>
                    <td>Warning only (logged but doesn't fail)</td>
                    <td>Standard business features</td>
                </tr>
                <tr>
                    <td><strong>LOW</strong></td>
                    <td>Nightly builds only</td>
                    <td>Edge cases, nice-to-have validations</td>
                </tr>
            </table>

            <h3>Library Modules</h3>
            <table>
                <tr>
                    <th>Module</th>
                    <th>Scope</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><strong>test-governance-annotations</strong></td>
                    <td>compile</td>
                    <td>Annotations only, zero dependencies (~20KB)</td>
                </tr>
                <tr>
                    <td><strong>test-governance-core</strong></td>
                    <td>test</td>
                    <td>Validation engine, scanning, reporting (~150KB)</td>
                </tr>
                <tr>
                    <td><strong>test-governance-spring-boot-starter</strong></td>
                    <td>test</td>
                    <td>Spring Boot auto-configuration (~50KB)</td>
                </tr>
                <tr>
                    <td><strong>test-governance-junit5</strong></td>
                    <td>test</td>
                    <td>JUnit 5 extension for non-Spring apps (~30KB)</td>
                </tr>
                <tr>
                    <td><strong>test-governance-maven-plugin</strong></td>
                    <td>build</td>
                    <td>Maven lifecycle integration (~40KB)</td>
                </tr>
            </table>

            <h3>Generated Reports</h3>
            <p>The framework generates audit-ready reports in JSON and HTML formats:</p>
            <ul>
                <li><strong>Coverage Summary</strong> - Overall percentage of business rules with test coverage</li>
                <li><strong>By Severity</strong> - Coverage breakdown by CRITICAL, HIGH, MEDIUM, LOW</li>
                <li><strong>By Owner</strong> - Coverage by team/person responsible</li>
                <li><strong>By Compliance Framework</strong> - Coverage for CMS, HIPAA, FISMA, etc.</li>
                <li><strong>Gaps Report</strong> - List of business rules without test coverage</li>
            </ul>

            <div class="info-box usecase">
                <strong>Use Case: Compliance Audit</strong>
                <p>During a CMS audit, auditors request evidence that all critical business rules are tested. The team runs <code>mvn test-governance:validate</code> which generates an HTML report showing 100% coverage for all CRITICAL severity rules tagged with CMS_SMC compliance. The report is submitted as audit evidence.</p>
            </div>
        </section>

        <!-- 12. API Gateway -->
        <section id="api-gateway">
            <h2>12. API Gateway</h2>

            <h3>Overview</h3>
            <p>The API Gateway is the single entry point for all client requests. It handles cross-cutting concerns like authentication, rate limiting, and routing before requests reach the backend services.</p>

            <h3>Gateway Responsibilities</h3>

            <h4>Request Routing</h4>
            <p>Routes requests to the appropriate backend service based on the URL path:</p>
            <ul>
                <li><code>/api/v1/*</code> → Backend Service</li>
                <li><code>/api/scheduler/*</code> → Scheduler Service</li>
                <li><code>/api/reports/*</code> → Reporting Service</li>
            </ul>

            <h4>Authentication Verification</h4>
            <p>Validates JWT tokens before forwarding requests. Invalid or expired tokens are rejected at the gateway, protecting backend services from unauthenticated requests.</p>

            <h4>Rate Limiting</h4>
            <p>Prevents abuse by limiting request rates:</p>
            <ul>
                <li>Per-user limits (e.g., 100 requests/minute)</li>
                <li>Per-IP limits for unauthenticated requests</li>
                <li>Different limits for different endpoints</li>
            </ul>

            <h4>Response Caching</h4>
            <p>Caches responses for frequently accessed, rarely changing data. Reduces load on backend services and improves response times.</p>

            <h4>Request/Response Transformation</h4>
            <p>Can modify requests and responses as they pass through:</p>
            <ul>
                <li>Add headers (correlation IDs, timing info)</li>
                <li>Strip sensitive headers</li>
                <li>Transform response formats</li>
            </ul>

            <h4>Load Balancing</h4>
            <p>Distributes requests across multiple backend instances for high availability and scalability.</p>
        </section>

        <!-- 13. Caching -->
        <section id="caching">
            <h2>13. Caching Strategy</h2>

            <h3>Overview</h3>
            <p>The framework uses Redis for caching to reduce database load and improve response times. Caching is applied at multiple levels with different strategies based on data characteristics.</p>

            <h3>Cache Levels</h3>

            <h4>Session Cache</h4>
            <p>User session data is stored in Redis, enabling stateless backend services. Any backend instance can handle any request because session state is external.</p>

            <h4>Application Cache</h4>
            <p>Frequently accessed data that rarely changes:</p>
            <ul>
                <li>Configuration values</li>
                <li>Reference data (status codes, categories)</li>
                <li>User permission lookups</li>
            </ul>

            <h4>Query Cache</h4>
            <p>Results of expensive database queries can be cached with appropriate TTL (time-to-live). Cache is invalidated when underlying data changes.</p>

            <h3>Cache Invalidation</h3>
            <p>When data changes, related cache entries are automatically invalidated through event listeners. This ensures cached data doesn't become stale.</p>

            <div class="info-box important">
                <strong>Cache Consistency</strong>
                <p>The framework uses a "cache aside" pattern with event-based invalidation. Data is always written to the database first, then cache is invalidated. On next read, fresh data is loaded from database and cached.</p>
            </div>
        </section>

        <!-- 14. Database -->
        <section id="database">
            <h2>14. Database Design Patterns</h2>

            <h3>Overview</h3>
            <p>The framework uses PostgreSQL as the primary database, leveraging its advanced features for performance, data integrity, and flexibility.</p>

            <h3>Key Design Patterns</h3>

            <h4>UUID Primary Keys</h4>
            <p>All tables use UUIDs as primary keys instead of auto-incrementing integers. This:</p>
            <ul>
                <li>Allows ID generation without database round-trip</li>
                <li>Prevents ID prediction/enumeration attacks</li>
                <li>Enables easier data migration and merging</li>
            </ul>

            <h4>JSONB Columns</h4>
            <p>PostgreSQL's JSONB type is used for flexible schema data:</p>
            <ul>
                <li>Metadata fields that vary by record</li>
                <li>Configuration objects</li>
                <li>Audit log snapshots</li>
            </ul>
            <p>JSONB is indexed and queryable, combining flexibility with performance.</p>

            <h4>Soft Deletes</h4>
            <p>A <code>deleted_at</code> timestamp column indicates deleted records. Active record queries automatically filter these out using a database view or Hibernate annotation.</p>

            <h4>Indexing Strategy</h4>
            <p>Indexes are created for:</p>
            <ul>
                <li>Foreign keys (for join performance)</li>
                <li>Frequently filtered columns (status, dates)</li>
                <li>Full-text search columns</li>
                <li>Unique constraints</li>
            </ul>

            <h4>Schema Migrations</h4>
            <p>Database schema changes are managed through Flyway migrations:</p>
            <ul>
                <li>Version-controlled SQL scripts</li>
                <li>Automatic migration on application startup</li>
                <li>Rollback support for failed migrations</li>
                <li>Migration history tracking</li>
            </ul>
        </section>

        <!-- 15. Error Handling -->
        <section id="error-handling">
            <h2>15. Error Handling</h2>

            <h3>Overview</h3>
            <p>The framework implements consistent error handling across all services. Errors are categorized, logged appropriately, and returned to clients in a standard format.</p>

            <h3>Error Categories</h3>
            <table>
                <tr>
                    <th>Category</th>
                    <th>HTTP Status</th>
                    <th>Examples</th>
                    <th>Client Action</th>
                </tr>
                <tr>
                    <td><strong>Validation Errors</strong></td>
                    <td>400</td>
                    <td>Missing required field, invalid format</td>
                    <td>Fix input and retry</td>
                </tr>
                <tr>
                    <td><strong>Authentication Errors</strong></td>
                    <td>401</td>
                    <td>Missing token, expired token</td>
                    <td>Re-authenticate</td>
                </tr>
                <tr>
                    <td><strong>Authorization Errors</strong></td>
                    <td>403</td>
                    <td>Insufficient permissions</td>
                    <td>Request access or use different account</td>
                </tr>
                <tr>
                    <td><strong>Not Found Errors</strong></td>
                    <td>404</td>
                    <td>Resource doesn't exist</td>
                    <td>Verify ID, check if deleted</td>
                </tr>
                <tr>
                    <td><strong>Conflict Errors</strong></td>
                    <td>409</td>
                    <td>Duplicate record, concurrent modification</td>
                    <td>Refresh and retry</td>
                </tr>
                <tr>
                    <td><strong>Business Rule Errors</strong></td>
                    <td>422</td>
                    <td>Invalid state transition, rule violation</td>
                    <td>Review business rules</td>
                </tr>
                <tr>
                    <td><strong>Server Errors</strong></td>
                    <td>500</td>
                    <td>Unexpected exception</td>
                    <td>Retry later, contact support</td>
                </tr>
            </table>

            <h3>Error Response Format</h3>
            <p>All errors follow a consistent JSON structure:</p>
            <ul>
                <li><strong>code</strong> - Machine-readable error code (e.g., "VALIDATION_ERROR")</li>
                <li><strong>message</strong> - Human-readable description</li>
                <li><strong>details</strong> - Array of specific field errors (for validation)</li>
                <li><strong>timestamp</strong> - When the error occurred</li>
                <li><strong>traceId</strong> - Correlation ID for log lookup</li>
            </ul>
        </section>

        <!-- 16. Monitoring -->
        <section id="monitoring">
            <h2>16. Monitoring & Health Checks</h2>

            <h3>Overview</h3>
            <p>The framework exposes endpoints and metrics for monitoring application health and performance. These integrate with standard monitoring tools like Prometheus, Grafana, and Kubernetes.</p>

            <h3>Health Endpoints</h3>

            <h4>Liveness Probe</h4>
            <p><code>/actuator/health/liveness</code> - Returns 200 if the application is running. Used by Kubernetes to know if the container needs to be restarted.</p>

            <h4>Readiness Probe</h4>
            <p><code>/actuator/health/readiness</code> - Returns 200 if the application is ready to serve traffic. Checks database connectivity, Kafka connectivity, etc. Used by load balancers to know if traffic should be routed to this instance.</p>

            <h3>Metrics</h3>
            <p>The framework exposes Prometheus-format metrics including:</p>
            <ul>
                <li><strong>JVM Metrics</strong> - Memory usage, garbage collection, thread count</li>
                <li><strong>HTTP Metrics</strong> - Request count, response times, error rates</li>
                <li><strong>Database Metrics</strong> - Connection pool usage, query times</li>
                <li><strong>Kafka Metrics</strong> - Messages produced/consumed, lag</li>
                <li><strong>Custom Metrics</strong> - Application-specific measurements</li>
            </ul>

            <h3>Logging</h3>
            <p>Structured JSON logging with:</p>
            <ul>
                <li>Correlation IDs for request tracing</li>
                <li>User context (who made the request)</li>
                <li>Timing information</li>
                <li>Configurable log levels per package</li>
            </ul>

            <div class="info-box usecase">
                <strong>Use Case: Troubleshooting Slow Requests</strong>
                <p>A user reports slow performance. Using the correlation ID from their request, you can trace through gateway logs, backend logs, and database logs to identify exactly where time was spent - whether it was network latency, a slow query, or an external service call.</p>
            </div>
        </section>
    </div>

    <footer>
        <p><strong>Sanra Solutions Enterprise Framework</strong></p>
        <p>Detailed Technical Documentation | Version 2.0 | January 2026</p>
    </footer>
</body>
</html>
